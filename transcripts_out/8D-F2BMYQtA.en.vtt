WEBVTT
Kind: captions
Language: en

00:00:00.000 --> 00:00:59.999 align:start position:0%
hello everyone hello everyone um welcome to the open protocol meeting um welcome to the open protocol meeting uh which is being live streamed um and uh which is being live streamed um and for all of you watching at home i just for all of you watching at home i just want to give a quick overview want to give a quick overview the goal of these meetings is to talk the goal of these meetings is to talk about and plan for changes to upcoming about and plan for changes to upcoming versions of the stellar protocol so versions of the stellar protocol so we go over core advancement proposals we go over core advancement proposals aka caps aka caps which are open source specs and they which are open source specs and they describe new features designed to evolve describe new features designed to evolve the protocol and meet ecosystem needs the protocol and meet ecosystem needs and the cap life cycle begins with the and the cap life cycle begins with the draft and today that's what we're draft and today that's what we're discussing discussing a draft specifically a draft of cap 21 a draft specifically a draft of cap 21 which is titled generalized transaction which is titled generalized transaction preconditions preconditions this cap has actually been kicking this cap has actually been kicking around for quite a while it was first around for quite a while it was first created in may of 2019 but with the um created in may of 2019 but with the um recent addition of claimable balances recent addition of claimable balances which were introduced in protocol 15 which were introduced in protocol 15 there were some new possibilities that there were some new possibilities that opened up and this week david naziris opened up and this week david naziris has been adapting the original proposal has been adapting the original proposal with those claimable balances with those claimable balances possibilities possibilities in mind so fair warning this is a

00:01:00.000 --> 00:01:59.999 align:start position:0%
in mind so fair warning this is a technical discussion so if you want to technical discussion so if you want to follow along follow along i suggest reading the cap and the recent i suggest reading the cap and the recent developer developer mailing list thread about it both of mailing list thread about it both of which are linked to in the event which are linked to in the event description description um so i think you know just a sort of um so i think you know just a sort of quick overview of cap 21 it generalizes quick overview of cap 21 it generalizes the time balance field in transaction the time balance field in transaction to support other conditions including to support other conditions including conditions that relax sequence number conditions that relax sequence number checking checking and that provide relative time locks it and that provide relative time locks it does that by extending account entry to does that by extending account entry to keep track keep track of the time and ledger number which an of the time and ledger number which an account sequence number was last changed account sequence number was last changed it also replaces the time bounce field it also replaces the time bounce field of transaction with a union of transaction with a union that allows more general transaction that allows more general transaction preconditions preconditions so the goal is to advance network so the goal is to advance network scalability by facilitating off-chain scalability by facilitating off-chain payment channels payment channels um and that's sort of like what we're um and that's sort of like what we're talking about today is this talking about today is this are there questions that we can answer are there questions that we can answer will this cap help will this cap help uh create those payment channels um it's uh create those payment channels um it's also to advance security and simplicity also to advance security and simplicity and interoperability with other networks and interoperability with other networks by enabling relative time locks by enabling relative time locks and finally it should make it easier for

00:02:00.000 --> 00:02:59.999 align:start position:0%
and finally it should make it easier for developers to create highly usable developers to create highly usable products products by enabling time-delayed queue recovery by enabling time-delayed queue recovery so today it's the first discussion of so today it's the first discussion of this newly revised this newly revised cap so part of what we're trying to do cap so part of what we're trying to do here is really just get like a sanity here is really just get like a sanity check check before we start prototyping anything um before we start prototyping anything um does anything have anyone have anything does anything have anyone have anything they want to want to add here at the top yeah as well as insanity check i think yeah as well as insanity check i think there's also so this one question is is there's also so this one question is the overall approach saying and the the overall approach saying and the other question is other question is uh nico's raised some points uh uh nico's raised some points uh uh many of which are you know things one uh many of which are you know things one could go either way on and so could go either way on and so it'd be nice to just kind of see what it'd be nice to just kind of see what the consensus is the consensus is for uh for where we should go for uh for where we should go great i mean and since this is sort of great i mean and since this is sort of something that you've been working on do something that you've been working on do you want to you want to start out with any any questions that start out with any questions that you might have or sort of pick a point you might have or sort of pick a point where you think the discussions will where you think the discussions will start we can go from there um yeah i start we can go from there um yeah i mean i think mean i think thanks for i think your summary uh was thanks for i think your summary uh was was pretty good here i mean i guess the was pretty good here i mean i guess the the things we could discuss are uh the things we could discuss are uh one you know does this seem useful for

00:03:00.000 --> 00:03:59.999 align:start position:0%
one you know does this seem useful for like a bunch of different scenarios like a bunch of different scenarios because if you have one mechanism that because if you have one mechanism that supports like a bunch of different supports like a bunch of different things then that's good so i've got things then that's good so i've got four examples of things that you can do four examples of things that you can do with this with this uh you know if people accept those uh you know if people accept those that's great if people have questions that's great if people have questions it's also great if people have other it's also great if people have other things like could it do this like i was things like could it do this like i was very grateful lee kind of suggested this very grateful lee kind of suggested this that you have a one-way payment channel that you have a one-way payment channel and maybe this isn't perfect but this is and maybe this isn't perfect but this is but the fact that i was able to cook but the fact that i was able to cook something up something up pretty quickly using this mechanism to pretty quickly using this mechanism to do something that do something that hadn't been one of the things we'd hadn't been one of the things we'd anticipated was uh anticipated was uh you know an encouraging sign i would say you know an encouraging sign i would say um yeah and then the other thing is like um yeah and then the other thing is like sort of nitpicky like technical sort of nitpicky like technical questions that we should get consensus questions that we should get consensus on so where should we start application so where should we start application like uses or uh like uses or uh or just dive right into the nitpicky or just dive right into the nitpicky questions questions david can you give a high level overview david can you give a high level overview why uh these things are relevant for why uh these things are relevant for payment channels ah okay good so payment channels ah okay good so the uh the the kind of overall

00:04:00.000 --> 00:04:59.999 align:start position:0%
the uh the kind of overall architecture architecture of a lot of payment channels and a lot of a lot of payment channels and a lot of other uh of other uh protocols frankly uh higher level protocols frankly uh higher level protocols on blockchains protocols on blockchains involves uh kind of a two-phase thing involves uh kind of a two-phase thing where uh you want someone to be able to where uh you want someone to be able to kind of recover unilaterally kind of recover unilaterally from a failure if the other party goes from a failure if the other party goes away or starts becoming non-cooperative away or starts becoming non-cooperative um but you don't want people to do um but you don't want people to do something something uh invalid so there's kind of one phase uh invalid so there's kind of one phase where you disclose that you're going to where you disclose that you're going to do something do something and then there's a certain amount of and then there's a certain amount of time in which someone else can object time in which someone else can object if you're doing something that's not if you're doing something that's not quite right like you're trying to for quite right like you're trying to for example example close a payment channel with an old uh close a payment channel with an old uh closing state and there's a closing state and there's a more recent closing state but then if more recent closing state but then if nobody objects nobody objects then after that time delay you're you're then after that time delay you're able to to close the channel so this able to close the channel so this pattern of kind of disclose and then pattern of kind of disclose and then finalize something um is extremely finalize something um is extremely important in a number of contexts important in a number of contexts um and so uh um and so uh with without cap 21 it is possible

00:05:00.000 --> 00:05:59.999 align:start position:0%
with without cap 21 it is possible but uh but both extremely tricky to do but uh but both extremely tricky to do with stellar with stellar and uh you have to sort of pay a time and uh you have to sort of pay a time penalty and that things where like for penalty and that things where like for example when someone fails you might in example when someone fails you might in a payment channel you might lose access a payment channel you might lose access to your funds for twice as long to your funds for twice as long because you cannot the only way to do it because you cannot the only way to do it is with kind of these is with kind of these uh pairs of transactions that have uh pairs of transactions that have non-overlapping absolute times non-overlapping absolute times uh in them essentially so uh we've we've uh in them essentially so uh we've done stuff like this like done stuff like this like starlight a long time ago was was uh was starlight a long time ago was uh was a proposal it uses it just gets a proposal it uses it just gets super complicated and so the idea here super complicated and so the idea here is like let's just make it a let's just is like let's just make it a let's just provide as a primitive the thing you provide as a primitive the thing you actually want actually want which is kind of the ability to do which is kind of the ability to do something after some relative something after some relative uh delay and since we already have this uh delay and since we already have this notion of accounts and sequence numbers notion of accounts and sequence numbers it seems like uh and since uh sequence it seems like uh and since uh sequence numbers are extremely useful for sort of numbers are extremely useful for sort of invalidating a bunch of stale invalidating a bunch of stale transactions you can just kind of give transactions you can just kind of give them successive sequence numbers them successive sequence numbers it seems like the simplest way to it seems like the simplest way to address this is to just uh address this is to just uh have a a transaction precondition says

00:06:00.000 --> 00:06:59.999 align:start position:0%
have a transaction precondition says you can do this transaction but only you can do this transaction but only when the account has been idled for a when the account has been idled for a certain amount of time certain amount of time therefore if the attack count gets therefore if the attack count gets changed when someone discloses that they changed when someone discloses that they want to do something want to do something you have to wait that amount of time you have to wait that amount of time before they can actually do the thing before they can actually do the thing and in that time and in that time uh somebody else can object by you know uh somebody else can object by you know raising the sequence number further and raising the sequence number further and invalidating whatever you were going to invalidating whatever you were going to do to close the transaction do to close the transaction so so that's kind of what what what led so that's kind of what what led to this uh to this uh the proposal so it might be worth the proposal so it might be worth mentioning that mentioning that uh the bitcoin protocol uh has relative uh the bitcoin protocol uh has relative time locks time locks they added it specifically for enabling they added it specifically for enabling the lightning the lightning uh network um just as a reference uh network um just as a reference um but it seems that david like you were um but it seems that david like you were talking about relative time locks but talking about relative time locks but your your proposal is actually much bigger than proposal is actually much bigger than that and also includes some some uh sequence number changes and maybe you sequence number changes and maybe you can talk a bit about that and why that's can talk a bit about that and why that's relevant relevant um yeah so um um yeah so um so the uh uh

00:07:00.000 --> 00:07:59.999 align:start position:0%
so the uh the sigma summer changes are because we the sigma summer changes are because we have uh have uh basically um it's our sequence basically um it's our sequence sequence numbers are extremely brittle sequence numbers are extremely brittle and hard to use and hard to use right in in protocols because basically right in protocols because basically you have to have you have to know the you have to have you have to know the exact sequence number in order for exact sequence number in order for for a transaction to run so uh so for for a transaction to run so uh so for example example one consequence of this is that um one consequence of this is that um in a you know if we don't have cap 21 in a you know if we don't have cap 21 and you're implementing payment channels and you're implementing payment channels the kind of disclosure disclosure the kind of disclosure transaction that sets you up to to close transaction that sets you up to close a payment channel a payment channel needs to be signed on multiple source needs to be signed on multiple source accounts you need multiple versions of accounts you need multiple versions of it because uh it because uh you know if you submit yours you know if you submit yours but you submit the wrong one then i but you submit the wrong one then i still need to submit one still need to submit one uh and so um and so it needs to be on a uh and so um and so it needs to be on a different source account because you've different source account because you've already burned the sequence number of already burned the sequence number of yours yours another example is you want to set it another example is you want to set it like a pre-signed

00:08:00.000 --> 00:08:59.999 align:start position:0%
like a pre-signed uh transaction um that will uh that you uh transaction um that will uh that you can kind of submit at any time to do can kind of submit at any time to do something like clean up some something like clean up some mess or something and uh again the mess or something and uh again the account account that's only valid if the count is like that's only valid if the count is like in a particular sequence number and so in a particular sequence number and so without i think overly uh complicating without i think overly uh complicating things um i added a feature where things um i added a feature where you can optionally for an account say by you can optionally for an account say by the way this transaction is valid the way this transaction is valid for a range of sequence numbers so for a range of sequence numbers so whenever you execute a transaction you whenever you execute a transaction you always leave the account state always leave the account state um the the the invariant is the um the the invariant is the transaction is only valid transaction is only valid when the sequence number of the when the sequence number of the transaction is transaction is greater than the sequence number of the greater than the sequence number of the account and after you've executed account and after you've executed a transaction the sequence number of the a transaction the sequence number of the account is always the sequence number account is always the sequence number the transaction you just the transaction you just executed until now it's always been the executed until now it's always been the case that case that it also that the sequence number the it also that the sequence number the account has to be exactly one account has to be exactly one less than the sequence number of the less than the sequence number of the transaction in order for the transaction transaction in order for the transaction to be valid

00:09:00.000 --> 00:09:59.999 align:start position:0%
to be valid with this new optional feature you can with this new optional feature you can add a different add a different a minimum sequence number so you can say a minimum sequence number so you can say actually i want this transaction to be actually i want this transaction to be valid valid for any sequence number below uh the for any sequence number below uh the sequence number of the transaction or sequence number of the transaction or for you know the last hundred sequence for you know the last hundred sequence numbers numbers um and so this makes transactions that um and so this makes transactions that you've kind of signed ahead of time a you've kind of signed ahead of time a lot less brittle lot less brittle the particular uh you know particular the particular uh you know particular example of where example of where where i use this well actually it seems where i use this well actually it seems to come up in in to come up in actually all of the the proposed actually all of the proposed applications so in payment channels applications so in payment channels it's useful because i can submit a it's useful because i can submit a disclosure transaction and if it's the disclosure transaction and if it's the wrong one you can submit a disclosure wrong one you can submit a disclosure transaction and they can both just be on transaction and they can both just be on the escrow account the escrow account we didn't need to have our special other we didn't need to have our special other accounts just for the sequence number accounts just for the sequence number because because you know an earlier disclosure you know an earlier disclosure transaction doesn't invalidate a later transaction doesn't invalidate a later one because the disclosure transactions one because the disclosure transactions are signed are signed to accept a range of sequence numbers to accept a range of sequence numbers um uh you know another place where this

00:10:00.000 --> 00:10:59.999 align:start position:0%
um uh you know another place where this might come up is might come up is where you have you want to be submitting where you have you want to be submitting large large numbers of transactions on one account numbers of transactions on one account you have like a farm of 100 servers that you have like a farm of 100 servers that are all like you know each are all like you know each uh each round they're kind of submitting uh each round they're kind of submitting a transaction uh a transaction uh on on the same source account and using on the same source account and using the new feature you can accept gaps in the new feature you can accept gaps in the in the sequence number space so if the in the sequence number space so if like one like one uh server happens to be down or not uh server happens to be down or not produce a produce a assigned transaction time that's okay assigned transaction time that's okay you can just skip over its transaction you can just skip over its transaction um another example that i had was uh um another example that i had was uh was uh recovering like if you want a was uh recovering like if you want a friend to be able to help you recover friend to be able to help you recover your account in case you lose your keys your account in case you lose your keys um you know you want to pre-sign a um you know you want to pre-sign a transaction that you give to them transaction that you give to them that they can just uh submit and will will add their signing key to your will add their signing key to your account but of course account but of course you don't want them to be able to do you don't want them to be able to do that immediately you want to have some that immediately you want to have some chance to object in case somebody chance to object in case somebody like steals their key and so again you like steals their key and so again you want

00:11:00.000 --> 00:11:59.999 align:start position:0%
want one transaction you can just submit that one transaction you can just submit that will bump this disclose that this is will bump this disclose that this is going to happen and bump the sequence going to happen and bump the sequence number all the way up to the point where number all the way up to the point where your friend can take over the account your friend can take over the account and then a second transaction with a and then a second transaction with a relative time lock that allows your relative time lock that allows your friend after a few days or whatever to friend after a few days or whatever to take over take over that account and help you regain access that account and help you regain access to your funds one thing that i wanted to can you guys one thing that i wanted to can you guys hear me hear me yes excellent one thing that i wanted to yes excellent one thing that i wanted to uh uh to kind of ask about was how you to kind of ask about was how you anticipate this interrupt anticipate this interrupt excuse me interacting with claimable excuse me interacting with claimable balance ids balance ids which are sequence number dependent is which are sequence number dependent is the anticipation that the anticipation that when you do one of these uh range when you do one of these uh range bounded bounded transactions on the sequence number that transactions on the sequence number that the sequence number is bumped to the the sequence number is bumped to the last sequence number prior last sequence number prior to submission like prior to the to submission like prior to the operations being applied so that operations being applied so that no matter where you were applied in the no matter where you were applied in the range the range the any claimable balance generated would any claimable balance generated would always be generated using an id that is always be generated using an id that is equal to the actual sequence number

00:12:00.000 --> 00:12:59.999 align:start position:0%
equal to the actual sequence number of the transaction so there should be no of the transaction so there should be no change the the the definition change the the definition of the operation id uh of the operation id uh still applies unchanged um in the sense still applies unchanged um in the sense that every transaction still has a that every transaction still has a sequence number sequence number the only thing we're changing and always the only thing we're changing and always leaves the account with that sequence leaves the account with that sequence number when it's finished executing number when it's finished executing the difference is simply that the the difference is simply that the transaction may be valid transaction may be valid even if a transaction with the prior even if a transaction with the prior sequence numbers have not executed yet sequence numbers have not executed yet so just to make sure i'm 100 on the same so just to make sure i'm 100 on the same page as you if the sequence number page as you if the sequence number bounds were minimum one maximum three bounds were minimum one maximum three whether i played the transaction at whether i played the transaction at sequence number one two or three sequence number one two or three the claimable balance would always be the claimable balance would always be created as if it was ab sequence number created as if it was ab sequence number three three um i think what you're saying is um i think what you're saying is technically correct but technically correct but that's not maybe not the clearest way to that's not maybe not the clearest way to view it so i just view it as there's no view it so i just view it as there's no maximum sequence number there's just a maximum sequence number there's just a sequence number sequence number which is just the sequence number of which is just the sequence number of your transaction your transaction and then there's a minimum sequence and then there's a minimum sequence number that says when your transaction number that says when your transaction starts being valid starts being valid and the minimum sequence number by

00:13:00.000 --> 00:13:59.999 align:start position:0%
and the minimum sequence number by default if you don't specify it is just default if you don't specify it is just one less than the sequence number of the one less than the sequence number of the transaction meaning like every transaction meaning like every transaction transaction can be submitted at exactly one sequence can be submitted at exactly one sequence number but you can number but you can uh you can reduce that minimum sequence uh you can reduce that minimum sequence number number down to all the way down to zero if you down to all the way down to zero if you want the reason i'm kind of asking about want the reason i'm kind of asking about it and asking about it specifically in it and asking about it specifically in this way is that the the language you this way is that the language you keep using is that keep using is that when the transaction finishes executing when the transaction finishes executing you will be at blah blah blah sequence you will be at blah blah sequence number number yeah but i actually think that the yeah but i actually think that the phrase you want to use is when the phrase you want to use is when the operation start executing you will be at operation start executing you will be at blah blah sequence number blah sequence number because otherwise it's quite ambiguous because otherwise it's quite ambiguous about which sequence number you're at about which sequence number you're at when you're actually doing these when you're actually doing these operations and also it's quite ambiguous operations and also it's quite ambiguous what it means to a bump sequence what it means to a bump sequence okay so let me actually address so okay so let me actually address so there's several points so there's several points so i so the way i was viewing it is that i so the way i was viewing it is that the the uh the the operation id uh the operation id in a claimable balance is depends on the in a claimable balance is depends on the actual sequence number of the actual sequence number of the transaction not the sequence number of transaction not the sequence number of the account the account um and the reason is that i was assuming

00:14:00.000 --> 00:14:59.999 align:start position:0%
um and the reason is that i was assuming that you kind of that you kind of execute transactions in two phases one execute transactions in two phases one in one phase you kind of in one phase you kind of claim all the fees and and bump all the claim all the fees and bump all the sequence and address those sequence sequence and address those sequence numbers and you know validate the numbers and you know validate the sequence numbers sequence numbers and then in a second phase you do all and then in a second phase you do all the operations including things like the operations including things like bump sequence bump sequence um but it is currently the case that for um but it is currently the case that for example example you could um you could submit two you could um you could submit two transactions transactions in the same block right and uh in the same block right and uh depending on the order in which they depending on the order in which they actually one of them could like bump actually one of them could like bump sequence to invalidate the other right sequence to invalidate the other right if they have different transaction level if they have different transaction level source accounts and so source accounts and so that behavior is sort of unchanged that behavior is sort of unchanged uh in that like all the validation and uh in that like all the validation and checking whatever is still checking whatever is still all happening before uh bump sequence but regardless of bump sequence when but regardless of bump sequence when you're generating a so forget cap 21 you're generating a so forget cap 21 when you're generating an operation id when you're generating an operation id it's still based on the sequence number it's still based on the sequence number of the transaction not the sequence of the transaction not the sequence number of the account in the sense that number of the account in the sense that if you have a bump transaction if you have a bump transaction that's not going to affect the operation that's not going to affect the operation ids right i'm actually

00:15:00.000 --> 00:15:59.999 align:start position:0%
ids right i'm actually i'm actually trying to confirm that i'm actually trying to confirm that right now i was under the impression right now i was under the impression that it was based off of the actual that it was based off of the actual sequence number of the sequence number of the account at the time that it executes so account at the time that it executes so that would make it difficult to predict that would make it difficult to predict the uh the operation ids uh which i the uh the operation ids uh which i think think might be a uh a problem with claimable might be a uh a problem with claimable balances if it's the case so that might balances if it's the case so that might be something be something independent of cap 21 that we might want independent of cap 21 that we might want to revisit regardless right maybe it's not it's regardless right maybe it's not it's it's not because you don't know the it's not because you don't know the order in which transactions on different order in which transactions on different source accounts are going to execute in source accounts are going to execute in the same block so the same block so you could have a situation where you you you could have a situation where you have a you have a transaction it you have a you have a transaction it you know know it it creates some claimable balances um it creates some claimable balances um uh and then um because some other uh and then um because some other transaction happened to call bump transaction happened to call bump sequence sequence that the claimable balances have a that the claimable balances have a different op id that would be different op id that would be oh but no no no we no no like the oh but no no we no like the sequence numbers are strictly sequence numbers are strictly like they are enforced at the time we

00:16:00.000 --> 00:16:59.999 align:start position:0%
like they are enforced at the time we apply the transaction apply the transaction yeah david is right though actually it yeah david is right though actually it comes from the transaction sequence comes from the transaction sequence number number not from the account sequence number and not from the account sequence number and so given that that's the case so given that that's the case cap 21 doesn't change that that then it cap 21 doesn't change that then it doesn't every every transaction doesn't every transaction still has a unique sequence number it's still has a unique sequence number it's just we're now we're now can just we're now can skip some sequence numbers we're a skip some sequence numbers we're a little bit more flexible at when a little bit more flexible at when a transaction runs transaction runs i have kind of a basic question which is i have kind of a basic question which is what was the original rationale for what was the original rationale for sequence numbers replay prevention sequence numbers replay prevention because we don't have because we don't have utxos um we need to utxos um we need to we just need to make sure that like a we just need to make sure that like a valid transaction cannot be submitted valid transaction cannot be submitted multiple times to you know double the multiple times to you know double the payments payments the reason the reason i'm asking is the reason i'm asking is because i could foresee that if this is because i could foresee that if this is a a feature uh for convenience feature uh for convenience maybe many people would use this feature maybe many people would use this feature so they don't have to think about so they don't have to think about sequence numbers sequence numbers and although that's like a choice that and although that's like a choice that they've made maybe this actually makes they've made maybe this actually makes their implementation less secure

00:17:00.000 --> 00:17:59.999 align:start position:0%
their implementation less secure well no they still need to think about well no they still need to think about it it's still it still prevents replay it it's still it still prevents replay but but one thing that this allows for example one thing that this allows for example is that let's say that you have a fairly is that let's say that you have a fairly low low volume uh you know account where you're volume uh you know account where you're not doing a lot of payments you could not doing a lot of payments you could decide decide that uh rather than query for that uh rather than query for uh the the latest sequence number the uh the latest sequence number the account account you could just kind of use the the like you could just kind of use the like the unix time the unix time epoch as like the low 32 bits of your epoch as like the low 32 bits of your sequence number right and and now sequence number right and now if you set your minimum sequence to zero if you set your minimum sequence to zero that that would just that would just work obviously you would it would not work obviously you would it would not work work you would like get some transactions uh you would like get some transactions uh rejected if you happen to rejected if you happen to on two different machines use the on two different machines use the generate transactions at exactly the generate transactions at exactly the same time and use the same sequence same time and use the same sequence number but if that's unlikely to happen number but if that's unlikely to happen then then maybe that's a that's a better trade-off maybe that's a better trade-off in some situations and we would allow in some situations and we would allow that that and just following up on just to make and just following up on just to make sure it's super clear to you eric like sure it's super clear to you eric like this wouldn't let you ignore sequence this wouldn't let you ignore sequence numbers imagine that you wanted to be numbers imagine that you wanted to be like hey you know i'm gonna set the like hey you know i'm gonna set the minimum minimum

00:18:00.000 --> 00:18:59.999 align:start position:0%
minimum number to one and the maximum number to number to one and the maximum number to n64 max that's not going to cause any n64 max that's not going to cause any problems but again there's no match i'm problems but again there's no match i'm not going to work not going to work there's no maximum number exactly please there's no maximum number exactly please don't use the term maximum number don't use the term maximum number uh it's going to take you straight to in uh it's going to take you straight to in 64 max you can do this one time and now 64 max you can do this one time and now you're a count stock i suppose we could uh we should actually i suppose we could uh we should actually do the um do the um maybe we should add the limitation the maybe we should add the limitation the same way bump sequence doesn't let you same way bump sequence doesn't let you bump to n64 max right because we have bump to n64 max right because we have some idea that we want to be able to some idea that we want to be able to delete the account and then delete the account and then recreate it and and not have old recreate it and not have old transactions be valid transactions be valid it does let you bump into 64 max it does let you bump into 64 max actually it just stuck actually it just stuck at that point and then you're just stuck at that point and then you're just stuck you need to use another okay because we you need to use another okay because we can't delete the account okay so great can't delete the account okay so great so fine we can just allow to have the so fine we can just allow to have the same thing then same thing then yeah so so is one way to think about yeah so is one way to think about this that it's a bit like a this that it's a bit like a normal transaction with a bump sequence normal transaction with a bump sequence uh uh built into it yeah but but with a slight built into it yeah but with a slight advantage that uh the bump sequence advantage that uh the bump sequence happens later in the happens later in the processing of a block um and this processing of a block um and this happens

00:19:00.000 --> 00:19:59.999 align:start position:0%
happens earlier during the initial phase of like earlier during the initial phase of like collecting fees and validating collecting fees and validating uh transactions but yeah it acts a lot uh transactions but yeah it acts a lot like an implicit like an implicit like basically you're you're implicitly like basically you're implicitly your sequence number is implicitly a your sequence number is implicitly a bump sequence now so where there are also you know i so where there are also you know i believe on the stellar dev mailing list believe on the stellar dev mailing list there were some specific technical there were some specific technical issues issues um that niko raised and i want to make um that niko raised and i want to make sure that we do sure that we do if they're important that we do have if they're important that we do have time to get to them does it seem like time to get to them does it seem like time to move on to those are there still time to move on to those are there still more sort of high level or general more sort of high level or general questions questions let's get specific okay so uh so the let's get specific okay so uh so the first one is that first one is that um i mean this is something i feel um i mean this is something i feel strongly about but it's not the hill strongly about but it's not the hill that i want uh that i want uh cap 21 to die on so um uh cap 21 to die on so um uh maybe we end up uh just deferring this maybe we end up uh just deferring this to some some leader cap but to some leader cap but the way we do extensions for unions by the way we do extensions for unions by kind of

00:20:00.000 --> 00:20:59.999 align:start position:0%
kind of uh kind of dangling more and more nested uh kind of dangling more and more nested structures off the nested unions off the structures off the nested unions off the end of a structure end of a structure is kind of messy and gross and it seems is kind of messy and gross and it seems like the reason we're doing this like the reason we're doing this is just because we're like uh we don't is just because we're like uh we don't have have enough like engineering resources to enough like engineering resources to kind of fix each individual kind of fix each individual sdk in a way that like frankly wouldn't sdk in a way that like frankly wouldn't be that hard if we had someone who is be that hard if we had someone who is like living and breathing that like living and breathing that that sdk um so that sdk um so uh so i you know i think it's it's much uh so i you know i think it's much better to do better to do your um have your extensions to unions your um have your extensions to unions be kind of like be kind of like having like an outer union so you can having like an outer union so you can just kind of keep improving the data just kind of keep improving the data structure structure and you know keep most of the fields the and you know keep most of the fields the same as opposed to having like many many same as opposed to having like many nested unions which is both nested unions which is both you know encodes in a more uh it takes you know encodes in a more uh it takes more bytes to encode and is like more bytes to encode and is like more of a pain to program to because you more of a pain to program to because you have all these nested unions so i'm suggesting that the account entry so i'm suggesting that the account entry extension that we replace extension that we replace the thing that's currently a v2 dangling the thing that's currently a v2 dangling off of v1

00:21:00.000 --> 00:21:59.999 align:start position:0%
off of v1 with uh with just a uh with uh with just a uh a v3 that that has everything in it and this isn't even like transaction and this isn't even like transaction state right this is like ledger state so state right this is like ledger state so like like but by the time you talk talking about but by the time you talk talking about software that's actually parsing these software that's actually parsing these like ledger entries like we're already like ledger entries like we're already in like in like pretty advanced software and not like pretty advanced software and not like random end users who were like random end users who were like uh doing xdr parsing on the um uh doing xdr parsing on the um on the actual blockchain state as on the actual blockchain state as opposed to transactions opposed to transactions i mean i i think the uh by the way this i mean i think the uh by the way this was the last was the last thing on the list i think in terms of thing on the list i think in terms of priorities i don't know why we're priorities i don't know why we're spending spending time yeah so again right now i mean we time yeah so again right now i mean we can't can't okay why don't we defer this to the end okay why don't we defer this to the end then um then um so the next uh next question so the next uh next question um is that uh and this is kind of a more um is that uh and this is kind of a more general general point but it's like coming up here too point but it's like coming up here too we have we're using a combination we have we're using a combination of signed and unsigned uh integers

00:22:00.000 --> 00:22:59.999 align:start position:0%
of signed and unsigned uh integers for uh durations and time points and it for uh durations and time points and it would be super nice if we could kind of would be super nice if we could kind of unify that across everything um unify that across everything um and so my proposal so i don't and so my proposal so i don't i don't have a strong uh opinion on i don't have a strong uh opinion on which because 62 to the 64 or 2 to 63 which because 62 to the 64 or 2 to 63 are both very large numbers of seconds are both very large numbers of seconds uh john has suggested that it's useful uh john has suggested that it's useful to to you know do queries in sql and that sql you know do queries in sql and that sql doesn't have doesn't have good support for unsigned 64-bit good support for unsigned 64-bit entities not just sql it's also entities not just sql it's also uh no other languages sure so uh no other languages sure so uh so what we could do is change time uh so what we could do is change time point to be point to be assigned 64-bit integer have duration be assigned 64-bit integer have duration be assigned 64-bit integer assigned 64-bit integer um and we would just say that any time um and we would just say that any time bounds that bounds that is negative uh is just treated as is negative uh is just treated as like you know n64 max basically for like you know n64 max basically for backwards compatibility and i doubt any backwards compatibility and i doubt any why would anyone why would anyone nobody is going to care about if they've nobody is going to care about if they've already signed a transaction whether the already signed a transaction whether the time bounds is like 2 to the 63 or 2 to

00:23:00.000 --> 00:23:59.999 align:start position:0%
time bounds is like 2 to the 63 or 2 to the 64 seconds from the epic right i mean i think a priori i think that i mean i think a priori i think that sounds fine to me i'd have to sounds fine to me i'd have to just look carefully through everything just look carefully through everything and make sure that it uh and make sure that it uh doesn't break anything terribly i mean doesn't break anything terribly i mean but a priori but a priori i agree like nobody cares if something's i agree like nobody cares if something's gonna happen in 2200 or i don't know gonna happen in 2200 or i don't know two to the 64 must put you into like the two to the 64 must put you into like the 30 000 or something i don't know 30 000 or something i don't know something like that no i mean it's got to be much more than no i mean it's got to be much more than that because 32 bits already gets us to that because 32 bits already gets us to like like 20 30 something right so 16. yeah no 20 30 something right so 16. yeah no yeah you're totally right you know yeah you're totally right you know he death of the universe kind of thing he death of the universe kind of thing like i think we got bigger problems to worry i think we got bigger problems to worry about at that point in time about at that point in time like yeah even changing crypto yeah like yeah even changing crypto yeah yeah exactly i think my problem said 25 yeah exactly i think my problem said 25 deep by that point deep by that point okay so for that one is that is that okay so for that one is that where we're landing it sounds a priori where we're landing it sounds a priori okay but like we should go to sign

00:24:00.000 --> 00:24:59.999 align:start position:0%
okay but like we should go to sign 64-bit 64-bit and we just have to be a little careful and we just have to be a little careful about legacy you know do it in a way about legacy you know do it in a way that doesn't that doesn't mess up legacy transactions um okay so another question so okay so another question so someone so again uh you know i just like someone so again uh you know i just like doing things doing things uh nice and simple and figure we already uh nice and simple and figure we already have unions like we've already got have unions like we've already got two kinds of precondition now no two kinds of precondition now no precondition uh precondition uh uh time bounds and then these like uh time bounds and then these like general preconditions so if we want to general preconditions so if we want to add more stuff we could just add a new add more stuff we could just add a new kind of kind of precondition um you know precondition um you know but an alternative would be to kind of but an alternative would be to kind of turn this into a little language turn this into a little language um like like the claimable balance um like the claimable balance preconditions and you know having like preconditions and you know having like an array of different an array of different things um you know things um you know uh again the proposal could work either uh again the proposal could work either way way um i like this way because it's simpler um i like this way because it's simpler but if

00:25:00.000 --> 00:25:59.999 align:start position:0%
but if there's overwhelming uh desire to go the there's overwhelming uh desire to go the other way other way we can do that as well i guess one concern you can go first i guess one concern you can go first nico i was just waiting to see if nico i was just waiting to see if anybody wanted to go first anybody wanted to go first yeah i know i was like thinking that if yeah i know i was like thinking that if we just do this pattern right without we just do this pattern right without the array i think it would just end up the array i think it would just end up growing if we add more as we add more growing if we add more as we add more condition even actually with the current condition even actually with the current version version uh like you always use like the worst uh like you always use like the worst almost like max almost like max max maximum size bikewise max maximum size bikewise um that doesn't seem like a you know um that doesn't seem like a you know a good property i think in terms of a good property i think in terms of complexities complexities you know we can make it that it's you know we can make it that it's actually fairly simple like i would say actually fairly simple like i would say like you know like you know the array has to be strictly ordered by the array has to be strictly ordered by you know uh value for example right like you know uh value for example right like you cannot put like you cannot put like that's where you have like a normalized

00:26:00.000 --> 00:26:59.999 align:start position:0%
that's where you have like a normalized uh form right uh you can't uh form right uh you can't you have to put for example time bomb you have to put for example time bomb before before sequence number right uh things like sequence number right uh things like that that um and if you did that could you expand um and if you did that could you expand the the possibilities yeah that's it yeah i mean this thing is yeah that's it yeah i mean this thing is like 20 bytes right if it's not like 20 bytes right if it's not if it's not doing anything so uh let's if it's not doing anything so uh let's see there's one there's one see there's one two three four yeah five things so like two three four yeah five things so like 20 bytes 20 bytes um i don't know 24 because the direct um i don't know 24 because the direct duration is like 64 bits duration is like 64 bits but i mean uh i mean especially for but i mean uh i mean especially for things like things like yeah i don't know i mean i i can make it yeah i don't know i mean i can make it work the other way it'll be work the other way it'll be it'll be like you know more complicated it'll be like you know more complicated to implement everywhere to implement everywhere there'll be like more weird edge there'll be like more weird edge conditions um conditions um you know i i i think that in the end you know i i think that in the end maybe you'll shave you know maybe you'll shave you know eight or 12 bytes off the size of some

00:27:00.000 --> 00:27:59.999 align:start position:0%
eight or 12 bytes off the size of some uh preconditions and others will be uh preconditions and others will be larger and you know maybe like four larger and you know maybe like four bytes bigger or the same bytes bigger or the same um to me i don't know like um to me i don't know like to me it's like the you know it's called to me it's like the you know it's called generalized but it's not generalized generalized but it's not generalized type of thing you know it's kind of type of thing you know it's kind of you know we want it to be generalized you know we want it to be generalized like a place where we can add more and like a place where we can add more and more conditions and then more conditions and then what if i called it something less what if i called it something less arrogant than general preconditions arrogant than general preconditions like you know relatives or like you know relatives or relative general preconditions v1 or relative general preconditions v1 or something i guess you yeah you ask for something i guess you yeah you ask for it because it because it's like when people call the function it's like when people call the function you're smart something you know it's not you're smart something you know it's not smart right smart right uh but no no no i'm i'm just saying like uh but no no i'm just saying like um um i don't necessarily think it's it's a i don't necessarily think it's a name problem name problem i think it's more of a yeah the pattern i think it's more of a yeah the pattern like what what is the pattern that we like what is the pattern that we want to have here and i want to have here and i i can see that fairly i can see that fairly you know maybe not in the in the far you know maybe not in the far future future we'll have like yeah like some new we'll have like yeah like some new conditions that pop up and conditions that pop up and do i want to again like

00:28:00.000 --> 00:28:59.999 align:start position:0%
do i want to again like uh you know have like it's it goes back uh you know have like it's it goes back i guess to this other point about half i guess to this other point about half the weekend the weekend yeah fractures right uh how much pain do yeah fractures right uh how much pain do you want to have you want to have in the uh yeah and i guess here i just i in the uh yeah and i guess here i just i don't don't i don't agree that the pain needs to be i don't agree that the pain needs to be uh very very high i just think there's a uh very high i just think there's a there's a there's like a kind of a bug there's a there's like a kind of a bug in our ecosystem that we make these in our ecosystem that we make these uh union uh upgrades more painful than uh union uh upgrades more painful than than they should be part than they should be part for me kind of what i'm looking at here for me kind of what i'm looking at here is if we think is if we think that this is a pretty reasonable that this is a pretty reasonable representation of all the things we'll representation of all the things we'll need in the near future like near future need in the near future like near future being like being like let's call it the next year i mean we let's call it the next year i mean we lived with just sequence lived with just sequence with just time bounds and single with just time bounds and single sequence numbers for like sequence numbers for like i don't know much longer than that five i don't know much longer than that five years i guess um years i guess um so if we think we're gonna make it that so if we think we're gonna make it that kind of length i don't feel any need to kind of length i don't feel any need to go go super crazy making this uh complex and super crazy making this uh complex and extensible extensible but i remember seeing i don't know maybe

00:29:00.000 --> 00:29:59.999 align:start position:0%
but i remember seeing i don't know maybe it was in the actual proposal maybe it it was in the actual proposal maybe it was in the notes for this meeting i was in the notes for this meeting i don't remember which don't remember which discussion about whether we should be discussion about whether we should be like implicitly elevating like implicitly elevating and which is the way that it's currently and which is the way that it's currently written you need to meet written you need to meet all the preconditions uh versus or all the preconditions uh versus or uh if we do something like if we care uh if we do something like if we care about or about or then probably it warrants something more then probably it warrants something more complicated but i think that or complicated but i think that or also might uh might also might uh might might put you into people not being able might put you into people not being able to understand what they mean to understand what they mean yeah i mean you're certain like foot yeah i mean you're certain like foot guns and stuff like i mean like guns and stuff like i mean like you know first of all i actually haven't you know first of all i actually haven't yet come up with a yet come up with a an example where or you need an example where or you need or that's not to say they don't exist um or that's not to say they don't exist um and i would appreciate people speaking and i would appreciate people speaking up if they have any such examples up if they have any such examples um you can also do or by just signing um you can also do or by just signing multiple transactions multiple transactions yeah that's not impossible yeah that's not impossible so i would really like to i mean so i would really like to i mean especially because i think like to the

00:30:00.000 --> 00:30:59.999 align:start position:0%
especially because i think like to the extent we want extent we want to go crazy we can do that with to go crazy we can do that with claimable balances claimable balances right like we already have a little or right like we already have a little or or we should like try to unify the or we should like try to unify the languages right like which is somehow languages right like which is somehow make make like have a notion of precondition that like have a notion of precondition that can apply to both clinical balances and can apply to both clinical balances and regular accounts and stuff and once we regular accounts and stuff and once we start doing this i'm just seeing this start doing this i'm just seeing this thing like spiral thing like spiral out of control um and i think it's like out of control um and i think it's like we're not like we're not like saying we can never do this like we can saying we can never do this like we can have like a you know have like a you know a new uh we can add a new thing to the a new uh we can add a new thing to the union like when when we decide this is union like when we decide this is this is done but like look like you know this is done but like look like you know i just let's just i just let's just try to be good and not perfect for this try to be good and not perfect for this because because like what we have here is just simple like what we have here is just simple it's easy to understand it's easy to understand i think it's not going to be too bad to i think it's not going to be too bad to implement implement and i think it will be already enabled and i think it will be already enabled like a huge number of use cases like a huge number of use cases you know i mean as oleg was pointing out you know i mean as oleg was pointing out this morning like in order to make this morning like in order to make lightning really work on lightning really work on on bitcoin they had to go through like on bitcoin they had to go through like four different soft forks or something four different soft forks or something um so like maybe it's not perfect and

00:31:00.000 --> 00:31:59.999 align:start position:0%
um so like maybe it's not perfect and maybe we'll want to make other changes maybe we'll want to make other changes but but we have that ability because we have we we have that ability because we have we have unions so have unions so i think this claimable balance point is i think this claimable balance point is worth talking about for two minutes worth talking about for two minutes though i mean do we think we're going to though i mean do we think we're going to be be wanting to add this kind of thing to wanting to add this kind of thing to claimable balances claimable balances i'm asking because i'm feeling the pain i'm asking because i'm feeling the pain of clinical balances in horizon right of clinical balances in horizon right now and how now and how we wish we'd made the ids more general we wish we'd made the ids more general because we built everything around because we built everything around accounts but it turns out clingable accounts but it turns out clingable balances have similar balances have similar properties to occur i mean the the thing properties to occur i mean the thing that the the predicates on that the predicates on uh climate balances have is that they uh climate balances have is that they don't they they're less monotonic don't they they're less monotonic than this stuff so kind of intentionally than this stuff so kind of intentionally like things like duration and like things like duration and and uh like sorry min seek age and and and uh like sorry min seek age and min secret ledger gap and stuff um min secret ledger gap and stuff um they they have a monotonic property that they have a monotonic property that they'll you know like once they're valid they'll you know like once they're valid they'll they'll they'll stay valid right there's still a they'll stay valid right there's still a maximum time bounds because we're not maximum time bounds because we're not going to get and going to get and get rid of that in the ledger bounds but get rid of that in the ledger bounds but um and i think that that um and i think that uh that monotonicity makes it a lot

00:32:00.000 --> 00:32:59.999 align:start position:0%
uh that monotonicity makes it a lot easier to reason about like when you're easier to reason about like when you're sort of forwarding sort of forwarding multiple uh transactions on the same multiple uh transactions on the same uh source account you know whether they uh source account you know whether they can all be in the same block can all be in the same block you know we don't want to have you know we don't want to have situations where someone can kind of situations where someone can kind of waste a bunch of bandwidth by causing waste a bunch of bandwidth by causing validators to forward around invalid validators to forward around invalid transactions and things like that and so transactions and things like that and so the monotonicity the monotonicity uh helps with that as well you know once uh helps with that as well you know once you start adding in not in all these you start adding in not in all these other other operators that you no longer have that operators that you no longer have that and it just gets more complicated to and it just gets more complicated to reason about these things uh nico and john any pitfalls that you uh nico and john any pitfalls that you see in in see in implementing this whether it's a an sdf implementing this whether it's a an sdf team or someone in the ecosystem trying team or someone in the ecosystem trying to prototype this and still a core to prototype this and still a core for which part the uh the condition like for which part the uh the condition like the the i guess the only

00:33:00.000 --> 00:33:59.999 align:start position:0%
thing i thought so so in terms of like thing i thought so in terms of like the captain uh itself the captain uh itself uh like at apply time i don't think uh like at apply time i don't think there are like real there are like real problems from what i see like they are i problems from what i see like they are i mean it's a fairly simple change mean it's a fairly simple change actually actually um i'm still kind of um i'm still kind of trying to kind of really um trying to kind of really um wrap my head around like the wrap my head around like the like the um the coupling i guess in in some of those the coupling i guess in some of those things like the things like the like does that only work basically in like does that only work basically in for example like they are like the for example like they are like the limitations on the flooding that limitations on the flooding that david added last night that i i read david added last night that i read this morning in particular the the ones that are in particular the ones that are related to related to relative timelocks themselves i think relative timelocks themselves i think this this really only works if you basically do really only works if you basically do like the same type of setup or you have like the same type of setup or you have like two like two transactions where one kind of allows transactions where one kind of allows you to

00:34:00.000 --> 00:34:59.999 align:start position:0%
you to to gate the disclosure and then the to gate the disclosure and then the actual right you always have to do this actual right you always have to do this right it's kind of and in a way it kind right it's kind of and in a way it kind of bothers me a little bit that of bothers me a little bit that you know we have those constructs and you know we have those constructs and they don't work independently i mean they don't work independently i mean like all one actually requires the other like all one actually requires the other one one and i don't know it kind of sorry but and i don't know it kind of sorry but that's the point right you want that you that's the point right you want that you want to do you want to have to want to do you want to have to performing the action should require the performing the action should require the disclosure right you know i understand disclosure right you know i understand but it's but it's uh in terms of the construct like you uh in terms of the construct like you have this construct that cannot be used have this construct that cannot be used outside of of the outside of the the combination right like normally we the combination right like normally we try to make things that try to make things that like for example the sequence number like for example the sequence number thing that can be used in thing that can be used in any other source of context right the any other source of context right the other one other one the relative condition the relative condition has to be used with sequence numbers uh has to be used with sequence numbers uh like i mean um like actually like i mean um like actually like other transactions actually it has like other transactions actually it has to be paired with some other scheme

00:35:00.000 --> 00:35:59.999 align:start position:0%
to be paired with some other scheme otherwise it's a food gun right like uh otherwise it's a food gun right like uh like like people will not realize maybe that the people will not realize maybe that the you know it's actually a fairly subtle you know it's actually a fairly subtle thing right that thing right that you it you know if some evil you it you know if some evil person is is constantly kind of person is constantly kind of pushing transactions in front of you pushing transactions in front of you then your relative then your relative time kind of keeps moving but it's time kind of keeps moving but it's always uh you know always uh you know uh not where you want it to be right uh not where you want it to be right and you're in in the it's not it's like and you're in the it's not it's like you have to use it i mean there are you have to use it i mean there are other patterns where you could use it other patterns where you could use it right you can imagine right you can imagine you know if my account is idle for a you know if my account is idle for a year i want year i want you know my family members to be able to you know my family members to be able to like like uh access the the funds or something uh access the funds or something right so you could just right so you could just you could do it as a kind of a a trigger you could do it as a kind of a trigger for for idleness for idleness uh so it doesn't have to it doesn't have uh so it doesn't have to it doesn't have to be for that but it seems like the to be for that but it seems like the the most most of the cases do involve the most of the cases do involve this this pattern this pattern um of disclose and then act

00:36:00.000 --> 00:36:59.999 align:start position:0%
um of disclose and then act um but i mean i think it's kind of um but i mean i think it's kind of a very useful pattern right so it is a very useful pattern right so it is something something no the pattern is useful what i'm saying no the pattern is useful what i'm saying is more like uh is more like uh like i guess you gave an example that like i guess you gave an example that where i mean this is useful in a context where i mean this is useful in a context so we so we you don't pre-sign many transactions and you don't pre-sign many transactions and maybe that's okay maybe that's okay right um i don't know i mean maybe so right um i don't know i mean maybe so actually actually i thought i understood your point but i thought i understood your point but now i'm actually confused so i thought now i'm actually confused so i thought that your pro your problem was like well that your pro your problem was like well it's kind of inefficient because it like it's kind of inefficient because it like prevents you from pipelining prevents you from pipelining back-to-back back-to-back uh transactions or something but uh transactions or something but it's uh it was not an efficiency uh it's uh it was not an efficiency uh question it was more of a question it was more of a uh like a potential attack right like uh like a potential attack right like you pre-signed a bunch of transactions you pre-signed a bunch of transactions and then uh you expect and then uh you expect the that last one to just work but you the that last one to just work but you don't realize that maybe don't realize that maybe there are ways to uh touch the account there are ways to uh touch the account basically

00:37:00.000 --> 00:37:59.999 align:start position:0%
basically because you have all like an example of because you have all like an example of a payment channel right like you can a payment channel right like you can imagine that imagine that um you can actually uh if there was no if you can actually uh if there was no if if the sequence number was not working if the sequence number was not working in a way that it would uh in a way that it would uh uh remove uh remove all transactions you would end up in all transactions you would end up in situations situations in a situation where uh in a situation where uh the timestamp would keep moving from all the timestamp would keep moving from all transactions right so you end up transactions right so you end up invalidating invalidating basically your latest one and that's not basically your latest one and that's not the one you the one you you want to invalidate right we're not you want to invalidate right we're not invalidating you're just invalidating you're just uh delaying it like you sort of you're uh delaying it like you sort of you're worried about something like a live lock worried about something like a live lock situation situation where yeah someone has low signing where yeah someone has low signing threshold on the account and so they threshold on the account and so they keep keep you know exactly like this kind of stuff you know exactly like this kind of stuff right yeah i don't know right yeah i don't know from my perspective on this it's kind of from my perspective on this it's kind of like if you're doing pre-signed like if you're doing pre-signed transactions like transactions like you better know what you're doing or you better know what you're doing or you're probably going to screw yourself you're probably going to screw yourself up no matter what the pitfall is

00:38:00.000 --> 00:38:59.999 align:start position:0%
up no matter what the pitfall is but you can imagine a day where say but you can imagine a day where say someone provides a service that does someone provides a service that does pre-signed transactions pre-signed transactions right where where some of that right where some of that difficulty would be difficulty would be concealed but i still think that you concealed but i still think that you know like cap 21 is only going to make know like cap 21 is only going to make that less error-prone that less error-prone right because of the fact that you right because of the fact that you sequence something less brittle so sequence something less brittle so i mean uh you know there are i mean uh you know there are things you can do that are would be things you can do that are would be weird with this weird with this but uh but they would be weird anyway but uh but they would be weird anyway um i mean like you could have a um i mean like you could have a situation where like someone has low situation where like someone has low signing threshold in the account and signing threshold in the account and they keep they keep you know bumping a sequence number and you know bumping a sequence number and so my my idol thing so my idol thing uh you so my idol condition never kicks uh you so my idol condition never kicks in and i can't execute this but they in and i can't execute this but they could also could also use bump sequence to bump the sequence use bump sequence to bump the sequence number to number to you know max uh 64 and lock the account you know max uh 64 and lock the account too right so it's kind of like too right so it's kind of like you're already giving someone the power you're already giving someone the power to shoot you in the head and then to shoot you in the head and then don't you know i guess be happy if they

00:39:00.000 --> 00:39:59.999 align:start position:0%
don't you know i guess be happy if they only shoot you in the foot instead of only shoot you in the foot instead of the head or something but so can we just kind of accept that yes so can we just kind of accept that yes there there are ways to i mean there are ways to i mean yeah it was more of a yeah like yeah it was more of a yeah like like i said like a a concern that like i said like a concern that we are adding more complicated things we are adding more complicated things that you have to know to use that you have to know to use exactly right otherwise you know i mean exactly right otherwise you know i mean i guess maybe that's what i guess maybe that's what john is saying like you know those are john is saying like you know those are uh to be used only if you uh to be used only if you really understand what you're doing and really understand what you're doing and you know in a way like i think you know in a way like i think like when i when i see the um like when i see the um the actual payment channel protocol is the actual payment channel protocol is actually super easy to understand like actually super easy to understand like you can you can you know like it takes five minutes to you know like it takes five minutes to actually get it right like and you know actually get it right like and you know it's correct it's correct uh unlike you know like previous uh unlike you know like previous attempts so you know attempts so you know to me this is like uh the big win

00:40:00.000 --> 00:40:59.999 align:start position:0%
tomer had asked about you know tomer had asked about you know implementation challenges and i implementation challenges and i i agree with nikola that the apply time i agree with nikola that the apply time part of it should be like part of it should be like super easy i mean a couple new if super easy i mean a couple new if conditions a couple of conditions a couple of fields to update but like there's not fields to update but like there's not really any logic here so it's really any logic here so it's i think it's actually probably the i think it's actually probably the forwarding logic uh so there's two forwarding logic uh so there's two places where that's what i was going to places where that's what i was going to say dude say dude and the forwarding logic is like a and the forwarding logic is like a little bit more complicated but i think little bit more complicated but i think uh you know after i kind of thought it uh you know after i kind of thought it through and wrote that new section last through and wrote that new section last night which night which uh yeah by the way thank you nico for uh yeah by the way thank you nico for pointing that out should have been in pointing that out should have been in the the first version of this um i think it's first version of this um i think it's not uh too bad not uh too bad i think like the main challenge will i think like the main challenge will just be you know just be you know the the forwarding logic is already the forwarding logic is already complicated like there's lots and lots complicated like there's lots and lots of of conditions on conditions on conditions conditions on conditions and the main new challenge here is just and the main new challenge here is just the additional the additional bookkeeping burden of things that used bookkeeping burden of things that used to not be possible for example like you to not be possible for example like you receive a receive a trans transaction that's like signum trans transaction that's like signum three to seven or minsek three seek

00:41:00.000 --> 00:41:59.999 align:start position:0%
three to seven or minsek three seek number seven as david would prefer me number seven as david would prefer me prefer i specify it and then the next prefer i specify it and then the next thing you receive is thing you receive is min seek four sequinum six and now you min seek four sequinum six and now you can actually add that to the queue and can actually add that to the queue and so it's all about like do our data so it's all about like do our data structures allow us to do these things structures allow us to do these things efficiently efficiently yes no i'm not sure probably not yes no i'm not sure probably not actually right now actually right now uh so we'll probably have to redesign uh so we'll probably have to redesign that stuff to make those things fast that stuff to make those things fast um but like it's probably within the um but like it's probably within the realm of realm of doable just uh the type of thing that doable just uh the type of thing that we'll have to do a kind of detailed we'll have to do a kind of detailed study of like what do we actually have study of like what do we actually have to do before we touch anything lots of positive feedback here yeah this is exciting yeah this is exciting okay so in terms of my to-do uh things okay so in terms of my to-do uh things that i should revise here that i should revise here um it sounds like uh well i guess we um it sounds like uh well i guess we never really resolve the union thing never really resolve the union thing um if if i don't it sounds like if i

00:42:00.000 --> 00:42:59.999 align:start position:0%
um if i don't it sounds like if i don't want to don't want to i don't want to predicate this in an i don't want to predicate this in an argument about like unions and ledger argument about like unions and ledger state i should just dangle state i should just dangle the extension v3 off of v2 um the extension v3 off of v2 um which is my favorite but whatever i'll which is my favorite but whatever i'll just do that if i have to just do that if i have to um sounds like there is consensus that um sounds like there is consensus that we should have a duration we should have a duration and time that we should have duration and time that we should have duration and time point types that these should and time point types that these should be signed throughout be signed throughout um and so i can change that in this cap um and so i can change that in this cap and then it sounds like there's also uh and then it sounds like there's also uh kind of reasonable consensus that it's kind of reasonable consensus that it's okay okay to stick with just one big structure to stick with just one big structure with all the preconditions as opposed to with all the preconditions as opposed to trying to build a little language like trying to build a little language like for claimable balances and does it make sense for instance john and does it make sense for instance john you know you were saying that you know you were saying that you would need to to do a detailed study you would need to do a detailed study to figure out if the data structure to figure out if the data structure

00:43:00.000 --> 00:43:59.999 align:start position:0%
to figure out if the data structure would allow us to do these things would allow us to do these things efficiently does it make sense to also efficiently does it make sense to also start doing that or is that something start doing that or is that something that should happen that should happen post these revisions post these revisions uh yeah i mean our general goal is to uh yeah i mean our general goal is to try to do more stuff in parallel than we try to do more stuff in parallel than we used to so we can go faster used to so we can go faster uh we have a lot of stuff to do so i uh we have a lot of stuff to do so i don't know when that's going to get onto don't know when that's going to get onto our schedule our schedule david my guess is david will beat us david my guess is david will beat us but in theory we we can start that but in theory we can start that whenever at this point i would say whenever at this point i would say uh maybe nikola descents but i there's uh maybe nikola descents but i there's nothing blocking us from doing that and nothing blocking us from doing that and we've we've been doing a lot of work on we've been doing a lot of work on that code recently so it's very fresh in that code recently so it's very fresh in our mind so it actually could be a our mind so it actually could be a a pretty good time to do it are not mandatory to to write kind of are not mandatory to write kind of like a like a you know like a quick dirty uh perhaps you know like a quick dirty uh perhaps dirty prototype

00:44:00.000 --> 00:44:59.999 align:start position:0%
dirty prototype um and uh obviously if we accept um and uh obviously if we accept cap 21 in the future and and you know cap 21 in the future and you know merge changes merge changes you know we'll need to optimize but we you know we'll need to optimize but we can think about it let's do that first can think about it let's do that first cool cool this this uh cap is premised on the idea this uh cap is premised on the idea that it actually solves payment channels that it actually solves payment channels though right though right so we add another solution to payment so we add another solution to payment channels we'd have to revisit whether channels we'd have to revisit whether this is something we want to do this is something we want to do or or if i mean we do have other or if i mean we do have other solutions they just have undesirable solutions they just have undesirable properties right so this was the properties right so this was the best solution for payment channels it best solution for payment channels it would go ahead but if it wasn't then i would go ahead but if it wasn't then i guess we'd re-evaluate whether it was guess we'd re-evaluate whether it was still worth doing is that right still worth doing is that right yeah i mean or or we would do that we yeah i mean or we would do that we would tweak this because would tweak this because probably it seems unlikely that a good probably it seems unlikely that a good solution for payment channels solution for payment channels would not involve some kind of relative would not involve some kind of relative time lock it just could be that there's time lock it just could be that there's some other feature we need to add or some other feature we need to add or something something um or there's some small tweak that we um or there's some small tweak that we need here need here um so yeah definitely feedback

00:45:00.000 --> 00:45:59.999 align:start position:0%
um so yeah definitely feedback challenges like challenges like you know again it was great like lee you know again it was great like lee came up with this idea of uh you know came up with this idea of uh you know the one-way payment channels with the one-way payment channels with different trade-offs and so yeah so different trade-offs and so yeah so maybe i'll keep thinking about that maybe i'll keep thinking about that too see if see if we can push on that to too see if we can push on that to do like top-ups and stuff do like top-ups and stuff in there um yeah i think in there um yeah i think what i imagine actually is that there what i imagine actually is that there might be more work to do might be more work to do as people think in more detail about as people think in more detail about the closing like what really happens the closing like what really happens when you close the payment when you close the payment payment channel uh like i know in the payment channel uh like i know in the past a lot of the complexity past a lot of the complexity in the uh in the starlight in the uh in the starlight implementation was that implementation was that balances well we didn't have claimable balances well we didn't have claimable balances balances um and um um and um and then you have like yeah all the and then you have like yeah all the things that can fail and then you know things that can fail and then you know there's no way to retry there's no way to retry and then you're kind of stuck um and then you're kind of stuck um and uh yeah like thinking about um and uh yeah like thinking about um yeah like how to ensure that things yeah like how to ensure that things

00:46:00.000 --> 00:46:59.999 align:start position:0%
yeah like how to ensure that things are safe even if you go beyond the one are safe even if you go beyond the one transaction right like transaction right like because in this case you have this one because in this case you have this one transaction i mean i think it transaction i mean i think it probably works if nothing fails if probably works if nothing fails if everything is claimed our claimable everything is claimed our claimable balances uh but that's kind of you know balances uh but that's kind of you know we'll know as we uh we'll know as we uh actually go a little further yeah i mean actually go a little further yeah i mean the major major pain point was that the major pain point was that like paying out to the responder like paying out to the responder could actually fail and so therefore you could actually fail and so therefore you had to make sure that had to make sure that like you know it was a separate like you know it was a separate transaction from like restoring the transaction from like restoring the account account and now the claimable balances can't and now the claimable balances can't fail um fail um it's like it's fantastic right it's just it's like it's fantastic right it's just you can do everything and just like one you can do everything and just like one transaction that like fixes the thing transaction that like fixes the thing yeah what i'm saying is more like the yeah what i'm saying is more like the limit right there's a limit of 100 limit right there's a limit of 100 operations operations in a in one transaction so are there in a in one transaction so are there cases where you have to go beyond that cases where you have to go beyond that and if so is it just a matter of like and if so is it just a matter of like right now you do two times i maybe it's right now you do two times i maybe it's like three times i is that all there is like three times i is that all there is to it i don't know saying like to it i don't know saying like yeah a payment channel with like 100 yeah a payment channel with like 100 assets in it or something

00:47:00.000 --> 00:47:59.999 align:start position:0%
assets in it or something um that that would be interesting i um that would be interesting i think we actually could do well think we actually could do well yeah or like it depends if you do like yeah or like it depends if you do like multi-parties you know more than two multi-parties you know more than two parties like parties like you know all this stuff right yeah so you know all this stuff right yeah so yeah and i actually think all that will yeah and i actually think all that will work but i could uh work but i could uh if you'd like i could add a section on a if you'd like i could add a section on a like a a like a multi-party multi-asset channel that multi-party multi-asset channel that needs to span needs to span more than one trans closing transaction yeah i mean there's really no reason you yeah i mean there's really no reason you can't just have can't just have multiple closing transactions with just multiple closing transactions with just kind of successive sequence numbers kind of successive sequence numbers as long as they never fail right that's as long as they never fail right that's kind of the kind of the thing no no they can fail actually thing no they can fail actually because because it still consumes a because it still consumes a sequence number they can't be invalid sequence number they can't be invalid but they can fail right so if it turns but they can fail right so if it turns out you'd rather pay out with an out you'd rather pay out with an with an actual payment instead of a with an actual payment instead of a create clinical balance create clinical balance you can still do that uh it's just now you can still do that uh it's just now you have to consider the fact that that you have to consider the fact that transaction could fail therefore you transaction could fail therefore you can't pay out to multiple users in the

00:48:00.000 --> 00:48:59.999 align:start position:0%
can't pay out to multiple users in the same transaction you just have to have same transaction you just have to have multiple closing transactions yeah and multiple closing transactions yeah and then you have like the whole like then you have like the whole like what do you do with the leftover at the what do you do with the leftover at the end and yeah you know the leftover at end and yeah you know the leftover at the end is you just the end is you just the initiator gets control of the the initiator gets control of the account yeah but like that's you know account yeah but like that's you know i guess that's one decision you have to i guess that's one decision you have to make make on that front which is because we don't on that front which is because we don't have a way to have a way to um like the only thing we can do is um like the only thing we can do is basically basically leave it leave full control at the end leave it leave full control at the end of the leftover to like a given party of the leftover to like a given party uh you know which i think you want uh you know which i think you want anyway because someone had to like put anyway because someone had to like put up the up the base reserve and stuff for that account base reserve and stuff for that account so why not let them just get control so why not let them just get control it's also it has this other advantage it's also it has this other advantage that it lets the initiator that it lets the initiator uh unilaterally top up right that you uh unilaterally top up right that you don't have to like do some complicated don't have to like do some complicated protocol to top up like protocol to top up like the initiator can just kind of throw the initiator can just kind of throw more funds in there and then it can more funds in there and then it can either spend those or either spend those or it'll get them back automatically when it'll get them back automatically when it uh when it closes the channel leigh are you raising your hand yeah i i have a question back on um so i

00:49:00.000 --> 00:49:59.999 align:start position:0%
yeah i have a question back on um so i think i think we're getting in the think i think we're getting in the details of like details of like the specific payment channel the specific payment channel implementation but i i just had a implementation but i just had a thought on thought on something that you were raising nico something that you were raising nico about um about um you know the foot gun of just that min you know the foot gun of just that min sequence age sequence age um and i'm wondering if like one of the um and i'm wondering if like one of the early early proposals i think david that you shared proposals i think david that you shared um attempted to use claimant balances um attempted to use claimant balances as like the relative timeline so as as like the relative timeline so as opposed to having the relative time lock opposed to having the relative time lock in the account in the account it existed out in this external thing it existed out in this external thing somewhere else in the ledger somewhere else in the ledger and i think that has some like and i think that has some like undesirable undesirable properties that you know we wouldn't properties that you know we wouldn't want to do that with claimable balances want to do that with claimable balances but but um is is it worthless exploring that um is it worthless exploring that idea of having relative time locks being idea of having relative time locks being like like uh like a very simple small thing on the uh like a very simple small thing on the ledger ledger they get created outside of the account they get created outside of the account um um and we can define uh things like when and we can define uh things like when they expire they expire and therefore transactions yeah and therefore transactions yeah so actually the uh this i you know i

00:50:00.000 --> 00:50:59.999 align:start position:0%
so actually the uh this i you know i think we could still make think we could still make payment channels work if we got rid of payment channels work if we got rid of the min sequence number the min sequence number but actually it would have more foot but actually it would have more foot guns right i actually think the min guns right i actually think the min sequence number uh sequence number uh is there to reduce foot guns and to make is there to reduce foot guns and to make a lot of things a lot of things simpler by making sequence numbers less simpler by making sequence numbers less brittle brittle i'm also interested in lee's question i'm also interested in lee's question though it's something i've been though it's something i've been wondering this whole conversation wondering this whole conversation like are there things that we can do like are there things that we can do beyond changing the account state that beyond changing the account state that might be more powerful might be more powerful than just changing the underlying than just changing the underlying account state like you know recording account state like you know recording some other state or some other state or uh you know transmuting claimable uh you know transmuting claimable balances on a transaction balances on a transaction exactly i was actually referring to the exactly i was actually referring to the sequence age so i was actually meaning sequence age so i was actually meaning like move that out of the account like move that out of the account into like some you know you create a into like some you know you create a lock and that lock is lock and that lock is automatically locked for like a specific automatically locked for like a specific age or something like that

00:51:00.000 --> 00:51:59.999 align:start position:0%
okay so i mean i can tell you a couple okay so i mean i can tell you a couple things you could do but things you could do but they're all going to be uh more they're all going to be uh more complicated so one thing you could do is complicated so one thing you could do is you could somehow guarantee that you could somehow guarantee that a claim claimable balance uh will never a claim claimable balance uh will never be be valid and fail right so then you could valid and fail right so then you could kind of kind of use a claimable balances as a kind of use a claimable balances as a kind of synchronization primitive and be synchronization primitive and be guaranteed that you're not accidentally guaranteed that you're not accidentally going to burn going to burn a sequence number another thing that you a sequence number another thing that you could do could do is you could add a replay cache to each is you could add a replay cache to each account so you can have a new kind of account so you can have a new kind of transaction transaction that instead of instead of that instead of altering the sequence number it like altering the sequence number it like adds itself to the replay cache for adds itself to the replay cache for which you have to pay which you have to pay you know a base reserve um and then you know a base reserve um and then the transactions would get um you know the transactions would get um you know garbage collected from the replay cache garbage collected from the replay cache based on their uh based on their uh their max time or maybe based on like their max time or maybe based on like bumping the sequence number bumping the sequence number this starts getting complicated because this starts getting complicated because you don't want a single transaction to

00:52:00.000 --> 00:52:59.999 align:start position:0%
you don't want a single transaction to be able to kind of delete a million be able to kind of delete a million things from the database just because things from the database just because then that would be like an expensive then that would be like an expensive transaction so you'd have to kind of transaction so you'd have to kind of limit the per account number of entries limit the per account number of entries in the replay cache or somehow ensure in the replay cache or somehow ensure that they can't all be deleted at once that they can't all be deleted at once or or have some other operation that deletes have some other operation that deletes like only up to 100 like only up to 100 things from your replay cache um that things from your replay cache um that are stale are stale uh so that that again would that that uh so that again would that would simplify things because would simplify things because again you could kind of submit again you could kind of submit transactions it would be more a little transactions it would be more a little bit more general and useful than this bit more general and useful than this because now you wouldn't even have to because now you wouldn't even have to worry about worry about the relative sequence of these the relative sequence of these transactions you could have two transactions you could have two transactions on the same source account transactions on the same source account that could be submitted in either order that could be submitted in either order and they would both be allowed to uh to and they would both be allowed to uh to execute execute um so i'm happy to um so i'm happy to to cook up a proposal along this lines to cook up a proposal along this lines of a replay cache of a replay cache and i think it would be have some nice and i think it would be have some nice usability properties usability properties i think it would be much harder to i think it would be much harder to implement and i think it would end up implement and i think it would end up having some annoying warts owing to the

00:53:00.000 --> 00:53:59.999 align:start position:0%
having some annoying warts owing to the fact that fact that uh we want to bound the amount of work uh we want to bound the amount of work that any single transaction that any single transaction can cause validators to do so there's can cause validators to do so there's either gonna be like either gonna be like limits the replay cash or limits to how limits the replay cash or limits to how quickly it gets garbage collected uh leigh do you have more to say i say uh leigh do you have more to say i say you're still unmuted uh i'll leave okay on the replay topic i uh i'll leave okay on the replay topic i i have tons of ideas about this david if i have tons of ideas about this david if you want to talk about it that i want to you want to talk about it that i want to talk about in this context talk about in this context i actually drafted like a short proposal i actually drafted like a short proposal somewhere somewhere uh about this that you could do this in uh about this that you could do this in a in a very like no storage kind of way a in a very like no storage kind of way on the ledger uh on the ledger uh and still have no undesirable replay and still have no undesirable replay things things uh we could talk about it offline if you uh we could talk about it offline if you want to okay want to okay would it would it is it was your would it is it was your proposal good enough that we should proposal good enough that we should consider consider instead of min sequence number or talk instead of min sequence number or talk about that about that no it's kind of orthogonal to min no it's kind of orthogonal to min sequence number it's uh

00:54:00.000 --> 00:54:59.999 align:start position:0%
sequence number it's uh it avoids other kinds of problems but it it avoids other kinds of problems but it doesn't fix those problems so doesn't fix those problems so but it does allow you to submit but it does allow you to submit transactions without changing the transactions without changing the sequence number sequence number it does okay yeah let's talk about it does okay yeah let's talk about flying about that cool and i think we're pretty much out of and i think we're pretty much out of time i mean i don't know if if there's time i mean i don't know if there's anything anyone wants to say just at the anything anyone wants to say just at the end here but it sounds like there's some end here but it sounds like there's some pretty clear pretty clear next steps any final next steps any final parting words parting shots clever jokes awesome everyone well thank you for awesome everyone well thank you for coming into everyone who's watching coming into everyone who's watching thank you for watching this was thank you for watching this was a nice deep technical dive into cap 21 a nice deep technical dive into cap 21 and and more to come on there if you want to uh more to come on there if you want to uh know what's going on you can always know what's going on you can always join the stellar death mailing list and join the stellar death mailing list and you can also look at the github repo and you can also look at the github repo and look at the actual look at the actual um drafts for these kinds of proposals um drafts for these kinds of proposals and i appreciate and i appreciate everyone here for joining in the everyone here for joining in the conversation thanks so much

00:55:00.000 --> 00:55:59.999 align:start position:0%
conversation thanks so much you

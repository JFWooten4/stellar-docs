WEBVTT
Kind: captions
Language: en

00:00:00.000 --> 00:00:59.999 align:start position:0%
hey guys welcome to the engineering talk we are going to begin momentarily one thing i will say and i think one thing I will say and I think our host has posted in the channel but if you have questions while I'm going through this talk go ahead and scan the qr code and you can ahead and scan the qr code and you can send questions over and i'll take a look at them at the end of i'll take a look at them at the end of the discussion okay so yeah welcome this is a talk about polaris this is a talk about polaris which is a django application and framework that allows you to build anchor servers according to the standards that we define that are called Stellar ecosystem proposals or seps so django polaris is a tool that we use

00:01:00.000 --> 00:01:59.999 align:start position:0%
so that our tool that we build so that anchors can get their anchor service up quickly and with less work required so I'm going to go into the details of so I'm going to go into the details of how to build this anchor but before i do I'm gonna go over a brief presentation that just describes what it is how it works and what you can expect in how it works and what you can expect in this presentation so let's go ahead and begin so like i just said polaris is a so like I just said polaris is a django anchor app or i'd like to say it's an extendable django app which means that if you know anything about django and hopefully you do in this presentation because I'm going to be going into django code but django is a system it's a framework that allows you to plug and play different applications within the project and so polaris is an app it's a reusable and so polaris is an app it's a reusable app that you can plug and play within django applications and it provides an interface an api that developers can use to

00:02:00.000 --> 00:02:59.999 align:start position:0%
insert and customize the way that the anchor server responds and handles information the reasoning behind this is that set 24 which was the original standard that we implemented this for has a lot of things that are standard about it every anchor is going to be doing similar things they're all going to have deposit endpoints they're all going to have info endpoints they're all going to have what the step describes and when i say what the step describes and when I say the set sorry I'm just going to break out of my actually i'll stay in the slides until afterwards but 724 is a standard and it defines an api 724 is a standard and it defines an api for clients to be able to hit in order for clients to be able to hit in order to interface with the anchor and every anchor that implements sub 24 has the same endpoints the difference though is that every anchor has you know pieces of functionality that are custom to them so polaris what it does is implement the stuff that's standard that everybody's gonna do and then it allows people to customize their own instances with their you

00:03:00.000 --> 00:03:59.999 align:start position:0%
know their unique situation so overall it's less time for the anchor to build people can typically get this up within an hour because we're gonna do it right now and we maintain it the sdf maintains it so we're gonna continue to upgrade this make sure it's up to date with the recent standards make sure it's up to date with the sdk make sure it's up to date with the sdk upgrades and it's open source everything that i am going to use right now is viewable on am going to use right now is viewable on github and we have links for the documentation and code in following slides so in order to understand polaris we need to talk about integrations polaris offers integrations or integration functions or classes that allow anchors to register custom functionality with polaris so polaris is going to facilitate you know the api endpoints and build out what a step 24 server would be but there's things that polaris can't automate right so polaris can't automate your banking or payment rails right if you're an

00:04:00.000 --> 00:04:59.999 align:start position:0%
anchor in brazil you know me as the developer of polaris i don't know polaris I don't know what bank you're connecting with i don't what bank you're connecting with I don't know what api you're using i don't know what api you're using I don't know anything about that so what you need to do is inject your so what you need to do is inject your own banking and payment rails code into the polaris framework in the same way we don't know what information you need from users so you may need email and that's it or so you may need email and that's it or you may need a photo of the id you may need you know a variety of different information social security number here in the u.s there's a bunch of stuff that you could need you could require in you could need you could require in order to deposit or draw assets and so kyc kind of goes hand in hand and so kyc kind of goes hand in hand with user tracking you want to know who's using your service who they are how to reach them stuff like that there's uli customization so polaris comes out of the box with a decent ui but if you want to customize a decent ui but if you want to customize that ui you're free to do so and finally there's just transaction processing when the transaction gets to a certain state

00:05:00.000 --> 00:05:59.999 align:start position:0%
in the flow you may want to update some in the flow you may want to update some of your own data models to adjust for the data models to adjust for the change and so polaris can't automate any of those things so it provides rails integration classes so you would in your code you would write you know within the rails integration class a function that connects to your bank and actually makes payments to users and you're going to register that integration that you write with polaris and i'll show you how to do with polaris and i'll show you how to do that so that transitions you know well how do you use polaris well we're going to do two things in this talk we're going to install and configure polaris and we're going to implement the integration points or at least enough integration points to get the anchor server up and running and so there's going to be a few steps involved in that we're going to create a django project and hopefully people who are viewing this are familiar with django and are familiar with the seps I'm gonna brush over some details about the steps so you have some context but overall this talk is gonna assume that

00:06:00.000 --> 00:06:59.999 align:start position:0%
you know what I'm talking about when it comes to django and start ecosystem proposals you're going to install django you're going to install the django polaris package we're going to add polaris the django app itself to the project and then we're going to add a bunch of polaris settings and configuration options and finally we're going to register and add our data or asset that we're going to anchor within our database and in the asset that we're getting the asset that we're going to anchor in this database is a or on this anchor is our Stellar reference token srt it's just a fake token on test net that doesn't mean anything but it's used as demonstration so you can it's used as demonstration so you can show or show i can show how people you or show I can show how people you know build anchor services around an asset once we have all the configuration installation set up we're going to start implementing integrations so the first thing that we're going to do is build a an appropriate tomo file and if you're familiar with step 1 this

00:07:00.000 --> 00:07:59.999 align:start position:0%
is implementing that it's basically a file that describes the organization that owns the anchor and it gives a bunch of details about contact information and stuff about the asset that clients who are viewing the file are to need to know we're going to do a little bit of some we're going to do a little bit of some banking rails so we're not going to connect to any particular bank and so we're actually going to kind of just mock this up but the idea is that you would fill this but the idea is that you would fill this function in with actual banking payment rails code I'm just going to do what's required from a functional standpoint to make sure polaris is working once we have the tomol and banking rails integration set up we're going to register those integrations and then finally we're going to build the application with docker and get it running so hopefully that gives you a good overview of what's going to happen here and again remember everything that i work on here is open source and there are there's documentation available so if you want to check out the documentation it's available at djangopolaris.readthedocs.io

00:08:00.000 --> 00:08:59.999 align:start position:0%
and the code is available at github.com polaris and these pictures are the are some pictures from our test server or our reference anchor server that shows you how to do it it's basically an example and these are just some forms that plars provides out of some forms that plars provides out of the box so this is what the ui looks the box so this is what the ui looks like if you didn't do any customizations okay and we're gonna do questions after the demo but for now I'm going to transition into coding and i'll probably be hopping back and forth from the internet as well to reference the proposals and just demonstrate certain things okay cool we are right on schedule so this is pycharm I'm gonna be you know django polaris is a python application and what we're gonna do when we start off most python applications is create a virtual environment so actually sorry before i dive into the code here i do

00:09:00.000 --> 00:09:59.999 align:start position:0%
before I dive into the code here I do want to show you one thing and that's a demonstration of what you can expect an anchor to look like from a user's perspective and this is a little demo that we do so and this is a little demo that we do so what I'm doing here is this is a little demo wallet that mocks like what a user would see and we're going to walk through a step 24 flow before we get started so you can just see what it's going to look like but we're just going to use our reference server that the seller development foundation runs and provides and we're just going to walk through a deposit flow on testnet so this is what we're going to ultimately build we want to get to this point by the end of this talk so I'm going to make a deposit it's going to go through the step 24 flow and it's going to open up the actual interactive page the user is going to see so if i was a user this is the first so if I was a user this is the first form that would be presented to me I'm trying to make a deposit onto into my account on stuller and here is the amount field that's

00:10:00.000 --> 00:10:59.999 align:start position:0%
asking me you know to specify how much i plan to you know to specify how much I plan to deposit and so I'm going to tell them that I'm and so I'm going to tell them that I'm going to deposit a hundred dollars and on test net anchors need to assume that deposits are actually sent right on testing everything's fake right so I'm not actually gonna send money to the anchor it's just gonna assume or understand that it's on testnet and it doesn't need to wait for me to actually pay them it's gonna pay or send you know Stellar funds to my account and just to give you some like more context this con config option this is obviously the reference server that we're hitting the url of it but this is the secret key of my account but this is the secret key of my account and don't worry there's nothing you know don't worry there's nothing you know fancy on it you can check it out on fancy on it you can check it out on testnet but I'm just gonna deposit a 100 or 100 but I'm just gonna deposit a 100 or 100 srt into my account on testnet so let's go ahead and do that and so now django polaris after i submitted the django polaris after I submitted the amount is going to go ahead and work on amount is going to go ahead and work on depositing that those funds into my account so it's

00:11:00.000 --> 00:11:59.999 align:start position:0%
executing on the transaction as you can see and now it's complete so if i were to go and now it's complete so if I were to go to my account right now i could show you my account right now I could show you that i have at least 100 that I have at least 100 srt in my account and I'm not going to srt in my account and I'm not going to show you what that is it's not worth it but this is a kind of a page that displays all the information on the transaction so i sent them 100 supposedly i was charged I sent them 100 supposedly I was charged a dollar and one cents and the amount that i actually received and the amount that I actually received in my seller account the amount of srt is 98.99 and it you know tells you when is 98.99 and it you know tells you when it was completed in the status and all that kind of stuff so this flow of being presented some forms filling out forms being presented updates as the transactions submitted and then finally getting a you know notification that's complete that's going to be the user experience behind the scenes blogs is going to be doing a lot more and I'm going to walk doing a lot more and I'm going to walk through what that is okay so that's the end of the demo we're gonna go into the code and here

00:12:00.000 --> 00:12:59.999 align:start position:0%
we go bear with me in case something happens because something always happens in demos but let's see how far we get i think but let's see how far we get I think we're gonna be able to do it so like i was saying with any python so like I was saying with any python project you're going to want to create a virtual environment so I'm going to create a virtual environment right now using python 3. and i have a little shortcut that and I have a little shortcut that activates the virtual environment but let's just do it you know the normal but let's just do it you know the normal way so I'm just going to execute the activate function for the virtual environment so this is dot vmv and activate okay so now I'm in a virtual environment this little enclosed box where i can install my own packages and where I can install my own packages and make sure you know everything that I'm doing here is contained in here and it's not affecting anything else outside my project and before we do this actually I'm going to go to the documentation so this is the polaris documentation it's available at django polaris dot

00:13:00.000 --> 00:13:59.999 align:start position:0%
read the docs dot io and it's going to walk you through how to install polaris now I'm going to update this documentation in the future i'll probably have some kind of like tutorial page where it gives you a you know front to back it gives you a you know front to back how you set up basically what we're doing in this talk but for now I'm going to hop around these settings in these documentation pages because you know they have different information and it's not organized in one way where i can just kind of scroll way where I can just kind of scroll through so the first that we're gonna do we're just gonna copy and literally walk through these steps we're gonna install polaris and while that installs I'm just going to go over kind of what it holds going to go over kind of what it holds you know obviously it holds django and it holds it really holds everything that you're going to need to run this application so you don't need to actually install g separately or anything like that everything comes with polaris and it's ready to go so that's done now and now that we have the django polaris package we have django installed now because

00:14:00.000 --> 00:14:59.999 align:start position:0%
polaris comes with everything and what we're going to do is we're going to create a django project now this is yeah so i have this function called or yeah so I have this function called or this command line tool called django admin which comes out of the box with chango right so I'm going to create a django project start project and I'm going to call it app it's going to be super generic okay now if i look i actually have an app now if I look I actually have an app folder and you can see it in my source tree if you look in app in my source tree if you look in app i have a manage.pi script and this I have a manage.pi script and this manage.pi script is basically the entry point to all of django's functionality so whenever i run functionality so whenever I run python within the django context I'm going to run python manage.pi some command and then within the app i have all the files that are necessary I have all the files that are necessary for a django application and we're not going to go over again this is a django tutorial we're going to assume that you know generally what this is

00:15:00.000 --> 00:15:59.999 align:start position:0%
but it's helpful to understand where we're at so let's get started so now that we have our django project we have an app set up we are going to add polaris to our app to our project right so the first thing that we need to do is add these three apps here to the installed apps list in settings.pi so let's open up settings.pi this is a generated file that django creates for you it comes with a secret key that you're definitely going to want to keep secret so you would never want to check this file in to get you know it just being auto-generated you want to use environment variables and hide you know those secrets from users and developers but yeah this is a generated file for django and here's our installed apps list and we're just going to copy and paste the three apps that polaris requires into the list now let me go over what these are so this let me go over what these are so this package called cores headers this is a different package outside of polaris

00:16:00.000 --> 00:16:59.999 align:start position:0%
that is installed with polaris it ensures that your server allows requests to set 24 endpoints from any service or client so it just sets the course policy for the server this rest framework is a it's just a another app that polaris uses to build out its api and then finally you install the polaris app and because we have our own app right because django so this is a project right this app is a project but within the app i know is a project but within the app I know that the app and project word is going to get the app and project word is going to get confused here but within the app directory we have a django application called app so i can change application called app so I can change the name of this top level app thing that's the project directory and then within the project directory we have the app directory and the app directory is essentially the app that we are running right alongside the other apps that we have installed in our installed apps list so I'm going to also add app to the installed apps list too the next

00:17:00.000 --> 00:17:59.999 align:start position:0%
thing that we're going to do is we're going to add the coors middleware so that course package that i told you about it requires a middleware component jingo comes default with a bunch of middleware and our documentation actually requests that the coors middleware is above the common middleware so this is necessary for django reasons the middleware is the order matters I'm not going to go too far into deep I'm not going to go too far into deep into it but you want to make sure that into it but you want to make sure that we have all the components that we add and the correct ordering at least in this section cool and then finally we're going to add a project root setting to our project and this is to our project and this is going to tell polaris essentially where the top level is and it's going to look for an environment look for an environment file at the top level of this project so I'm going to you know initialize project root and I'm actually just going to make it the directory containing baster so baster

00:18:00.000 --> 00:18:59.999 align:start position:0%
it was generated automatically by django but it's actually this folder right here it's the right or actually is it so there's the file it takes the absolute path of that it's the directory containing that file oh it's actually this file so this is the application folder that baster is referencing and so I'm going to take the directory that contains that directory so project root is going to be my actual project polaris anchor 3. and this is important because we're going to add a dot m file and this is going to contain all of file and this is going to contain all of our environment variables that customize part of polaris deployment so let's go into there and polaris has a so let's go into there and polaris has a few environment variables right there that i need to just stick in right there that I need to just stick in the file so you know for the network that we're using we're going to be using the test net so this is the network pass phrase for that network and then this is the

00:19:00.000 --> 00:19:59.999 align:start position:0%
horizon instance or url of the instance that we'll be using and then this is our host url so we're going to be doing this all on localhost so I'm just going to do localhost dot 8000 there we go and that's it for environment variables for now and then we are going to add polaris urls all the endpoints that polaris exposes to our django application so that it's actually exposed so it's going to give me it's going to so it's going to give me it's going to complain to me right now because it doesn't have some of these functions so we're going to import include and then we're also going to import polaris.urls cool and so i don't know if you're cool and so I don't know if you're familiar with some of you maybe but so we have this admin endpoint that's already there it comes default with every django deployment and then on top of that at the root of the domain on top of that at the root of the domain so in order to get to the admin page you

00:20:00.000 --> 00:20:59.999 align:start position:0%
would go to your domain admin in order to hit any of the polaris endpoints it's just straight on the domain so polaris so polaris comes with a bunch of urls oh you know what it's cause pycharm doesn't know where my virtual environment is i was going to go into environment is I was going to go into the source code and show you what's offered but polaris offers a bunch of endpoints in fact they're described right here all these endpoints polaris provides and those urls are going to be exposed at the root of the domain okay so now that we have our urls installed we're going to where's the documentation link okay now that we have our urls added to the project we're actually going to stop here because this is a this is set up that's going to be required for every installation of polaris but now we're going to go through the steps that we're actually going to deploy so polaris can deploy any number of steps

00:21:00.000 --> 00:21:59.999 align:start position:0%
in any combination so you could you in any combination so you could literally do polaris and just deploy step one which is a tomophile you could deploy polaris and just do step 10. you could do polaris with everything you could do it with one of them missing you could do it with one of them missing and so forth right so we're going to set up polaris for step 1 we're going to set up polaris for step 1 10 and 24 and that encompasses everything that's required in order to successfully run a deposit withdrawal so let's go to step one the configuration required is just to add it to our active steps list just to add it to our active steps list so this active seps list in settings is a key setting in polaris it basically signals to polaris what we're running what kind what standards do we want to actually run on our server because we're not going to run them all by default right you may just want one of them so we're you may just want one of them so we're going to add step 1 to our active steps going to add step 1 to our active steps list and we're actually going to add step 10 and step 24 as well and this is going to tell polaris what urls to expose

00:22:00.000 --> 00:22:59.999 align:start position:0%
so that you don't have like a sep 31 url so that you don't have like a sep 31 url exposed when you're not using it okay that's actually all that's required in terms of configuration we'll go into the integrations later step 10 has the same thing except it requires a few new environment variables so let's add so this is actually this documentation is incorrect it says add the following variables to your settings file you don't need to add these two to your settings file I'm going to update this should actually go in your environment config and if you didn't know that django would complain to you about it so you'd figure it out but yeah so for step 10 we have this but yeah so for step 10 we have this thing called a signing seed which is essentially the server's password for signing transactions that then the client would sign as well and then the server would authenticate so I'm not going to go too deep into so I'm not going to go too deep into what step 10 is but it's just a way for what step 10 is but it's just a way for servers to confirm that a user that's using their service holds the account that they're actually trying

00:23:00.000 --> 00:23:59.999 align:start position:0%
to deposit to and this should just be like a random key pair that you keep secret so what I'm going to do is I'm actually just going to import Stellar's sdk import keyboard class and I'm just going to do a random key pair and then I just have the signing seed listed in the environment so again this is something you'd want to keep secret this would not be checked into git and this obviously won't be deployed but the code that I'm writing right now will actually be available in on my github and i'll send a you know i'll show a link and maybe we'll actually have it in the description of the event that'd be awesome too so you can obviously reference what I'm doing here or just watch the video back okay and then

00:24:00.000 --> 00:24:59.999 align:start position:0%
the server jwt key so once the client is authenticated the server is going to return a token that's essentially the client's password for interacting and hitting the server's endpoints and you just want to have a secret string that you use to encode the jwt so we're going to have this super secret jwt string you'd obviously want to make this something different cool so now we have everything we need for step 10. let's go to step 24. again we need to have the step 24 string again we need to have the step 24 string in our active steps we already did that but one thing that we need to do on top of that is we need to do on top of that is configure our static assets so as you saw in that little demo polaris comes out of the gate with a ui that's built in and ready to with a ui that's built in and ready to go for you to use and customize if you want to and it does and customize if you want to and it does that by having the static files app installed by having the static files app installed and having static resources to use for the ui and so we're going to configure the static resources in order to work and deploy

00:25:00.000 --> 00:25:59.999 align:start position:0%
so in order to do that we're going to so in order to do that we're going to add white noise to our installed apps list and white noise is a static file serving application it is a static file serving application it just makes serving static files more efficient so we're going to do that we're going to so we're going to do that we're going to go to settings we're going to go to installed apps oh actually it's a middleware this is another thing i need to fix the this is another thing I need to fix the documentation will be updated by the time i release 1.0 django is her by the time I release 1.0 django is her polaris is at 0.12 right now it's a pre 1.0 release but anyway this is supposed to go in the middleware so let's go to our middleware section it should be above it should it says it should be near the top of the list for best performance but still under coors middleware so we're going to go under coors middleware cool and we obviously want to make

00:26:00.000 --> 00:26:59.999 align:start position:0%
sure that the static files app is actually in our installed apps list and then finally we have some more settings for our settings file and these all pertain to the static files app so we're gonna have a root directory to contain all of our static files so each app that we installed rest framework polaris even the app that we're using right now has static files that it's going to use when it's running and so what django does is it collects all those apps into one spot instead of having to fetch them from a particular app so we're going to call a directory called collect static which is the name of the command that we're going to use to collect those files and we're going to have it be within the and we're going to have it be within the base directory so it's going to be just outside our inner app directory this is the url that our static assets are going to be available at for django so I'm just going to say it's for django so I'm just going to say it's polaris static and then we're using this storage component

00:27:00.000 --> 00:27:59.999 align:start position:0%
for the white noise static file serving section so this is just one of the many section so this is just one of the many ways that white noise can store files and then return them when they're requested by the client okay and then in order to collect those static files we're gonna run our first command from manage.pi and we're going to collect our static assets where did my camera where did my camera go okay there we go okay so we're going to run that command but that didn't work because we're not in the same directory as the app or the in the same directory as the app or the manage.pi script that's within our app directory okay so it gave me an error and it said nope you're not ready yet you don't have a signing seed environment variable but we do so what's the problem here oh i know we don't have our settings oh I know we don't have our settings file our django project isn't aware of

00:28:00.000 --> 00:28:59.999 align:start position:0%
our environment and that's that needs to be fixed so we're going to import django environ or environ this is a package that comes installed with polaris and we are going to check we're going to and we are going to check we're going to have an environment object we're going to check if the path to our environment exists so you remember how we are going to i so you remember how we are going to i told you we're going to use project root to know if the environment is there or that's where we're going to look so we're going to look at the directory the project group directory and we're going to look for a dot m file in that directory and then if it's there we're gonna read that file okay so now let's try this again and hopefully it knows that we have a signing seat now

00:29:00.000 --> 00:29:59.999 align:start position:0%
end is not defined you're right it's because it starts off with the environment package okay so now it's complaining about the server jwt key that's in the same file as the other environment so or as the other variables so i wonder so or as the other variables so I wonder why this is complaining about that but not the signing seed server jwt key is it because we have this spacing between the environment and or the equal sign yeah it was I guess okay we have one more step that i glossed over i guess more step that I glossed over I guess there's one more middleware oh right okay so before we so we set up so this page so before we so we set up so this page for this documentation is forcep6 and set 24 because they share a majority of the integrations that polaris offers

00:30:00.000 --> 00:30:59.999 align:start position:0%
but there is some setup that's necessary for step 24 particularly and specifically we have this same site middleware class that comes custom with every polaris deployment and this is more of a legacy component we now suggest that anchors or sorry that wallets show that anchors or sorry that wallets show anchors interactive flows in pop-ups but originally they were we but originally they were we instructed people to open them via iframes in order to show in order to have sessions within an iframe you need to have certain http headers and so this middleware class was born to inject those headers into every response so this is required just in case clients open up your interactive flow in an iframe as opposed to a pop-up so let's add this middleware class and then we can go ahead

00:31:00.000 --> 00:31:59.999 align:start position:0%
okay now it's added and it's supposed to be above session.middleware or sorry below oh no session.nowhere should be below same side middleware okay and then finally we need this form renderer class and this is going to allow for that really for that ui that we provide and it's going to allow you to override any of those assets so this is needed if you want so this is needed if you want to you know overwrite any static assets or use the default ui which you're going to want to do if you're running step 24. okay let's okay we're done with configuration now hopefully this will allow me to compile my static assets there it goes okay so now we have a new there it goes okay so now we have a new directory called static or collect static and it holds all the static assets that we're going to use within our application so that's great and i think now that we have everything

00:32:00.000 --> 00:32:59.999 align:start position:0%
and I think now that we have everything set up from a configuration standpoint we are free to go back to our database model section and actually create our asset so let's double check let's double check actually yeah let's before we run the service let's create our database so in order to create our database we need to run this migrate command this migrate command and in order to do that we need to and in order to do that we need to make sure that we have a place for the make sure that we have a place for the data to go so we're going to create a data directory outside of our application and there's going to be a sqlite file that is stored in that directory and polaris also comes out of the box supporting postgres and if you want to use mysql or some and if you want to use mysql or some other engine you're free to do so as long as you configure your database appropriately in the settings file and you install the appropriate connector django comes out of the box with psycho pg which is a connector for postgres but if

00:33:00.000 --> 00:33:59.999 align:start position:0%
you want to use mysql or something install your connector and then configure your database and it should be fine okay so now that we're about to configure our database we're going to do something a little different instead of having this config in database we're going to use django environs db function which is something that i like to do because it simplifies it just simplifies the configuration so instead of having that dictionary we're going to have a django.environ.m.d or no it's going to be m.d.b and then within actually so I'm gonna look at a project that i ran through look at a project that I ran through prior to building this because i've done this before and making sure I'm doing it right so let me look at the code here and just let me look at the code here and just make sure I'm doing this correctly let's just copy that so we're going to configure our database to use an environment variable to find the db

00:34:00.000 --> 00:34:59.999 align:start position:0%
and if that doesn't exist then we're going to have an sqlite file that we use going to have an sqlite file that we use so as you can see we're using environments database and we're going to look for the database url in the environment if it isn't there the default url that we're going to use is an sqlite path looking for data db.sqli3 within our project root directory now that we have our database configured let's try to create our database with python app slash manage.pi migrate boom our database is created and all the migrations have been executed so our database is in the appropriate state that is awesome so again polaris is a application right it's not just an sdk or a framework it comes fully implemented with endpoints database models you know static assets it's a full-fledged app the difference is that it also provides a framework or an api interface for you to customize its behavior

00:35:00.000 --> 00:35:59.999 align:start position:0%
so it holds two different tables two database tables asset and transaction and we're going to create our asset right now this is the asset that we're gonna anchor on our server so we're gonna go into the python console load the model for the asset object and create nasa in our database so we're in python from django from polaris we're going to import our model and in our model we're going to create an asset object with the code srt because that's the code for the asset that we're anchoring and the issuer is going to be the address of the issuing account and so when you're setting up your anchor this is going to be different for you right you're going to be anchoring a different asset with a different code and you're going to need to actually issue an asset and we have materials documentation that documents how to issue assets but for

00:36:00.000 --> 00:36:59.999 align:start position:0%
now we're just going to use the srt asset here so here is the public key for the issuer and I'm actually that's all I'm going to do for now I'm going to also enable sep24 this asset object also needs the distribution seed so there's two accounts for every asset there's an issuing account and there's a distribution account the distribution account is the one that's actually going to be receiving and sending payments and so we're going to need to control this account from polaris so we need the secret key for that account and I'm not going to show you right now in this screen but I'm going to add it in this screen but I'm going to add it to this asset in another screen that you guys can't see so yeah just give me three seconds yeah just give me three seconds to add that

00:37:00.000 --> 00:37:59.999 align:start position:0%
and this distribution seed by the way is going to be stored in our database and this is always something that you'd want to make sure is secure it's going to be encrypted in the database so whenever seeds are stored in the database they're encrypted but their own but then they're decrypted when they're brought into memory so I'm going to import or I'm going to so I'm going to import or I'm going to add this secret key for the distribution this secret key for the distribution account of srt and it's going to allow my polaris to control the distribution account cool okay so I just added the distribution seed and so now if you look at the asset in

00:38:00.000 --> 00:38:59.999 align:start position:0%
the database just look at the distribution account it generates the account from the seed that i entered so that I entered so that's available as well okay now that we have everything we need in that department in the asset department we're going to test out our anchor so let's go ahead and do that okay so we've configured it everything is correctly configured so let's actually run our service and see what we got here run our service and see what we got here so I'm going to go to manage.pi and run so I'm going to go to manage.pi and run the server okay cool so as you can see django has a server running at dot localhost.8000 and so if we go there you can see that we actually don't have anything on our route and that's okay but we do have endpoints for step 24 we have the authentication server which is septen and we have the tomo

00:39:00.000 --> 00:39:59.999 align:start position:0%
file so let's check out our tomo file so this is a very empty tomo file it has the standard you know pages that you would expect from an anchor but it's a locking sum so polaris implements the tomo file but it allows you to customize and to add things to it so this is the and to add things to it so this is the first integration that we're going to implement we're going to tell polaris that we have additional information to display in the tumble file so we're missing information about the currency is it anchored is it a crypto asset is a is it anchored is it a crypto asset is a fiat asset what kind of asset is it what who is the organization behind this server you know what's their contact information this kind of stuff is missing from the tone when we're going to add it right now okay so let's get out of our settings we're finally done with the settings we're done with the environment the urls are set up everything's good there let's go to actually we're going to create a new file so let's stop our server process for a

00:40:00.000 --> 00:40:59.999 align:start position:0%
second we're going to create a new file called app slash called app slash integrations and this file is going to contain all of our custom code all the code that augments polaris is going to be in this file and I'm also going to create an apps.pi file now apps.pi is a special file that django looks for in every application that's installed in the installed apps list and specifically it looks for a app config object within apps.pi and it runs any code within the app config class before starting the application so this is a good place for us to so this is a good place for us to register our integrations it's only going to do it once and it's going to make sure that polaris has the custom code that we write so from django.app import app config

00:41:00.000 --> 00:41:59.999 align:start position:0%
is gonna inherit from app config the name of our application and this is a django thing by the way if you look at a django thing by the way if you look at the documentation django outlines what this is and why you need to do it so we're just gonna again our app is named app nothing complex about it and then we're going to have a ready function and this ready function a ready function and this ready function is going to be run every time we start our application and it's just going to do any kind of setup it's just going to do any kind of setup necessary before running our service and so what we're going to do is we're going to register our integrations here so we're going to do from integrations import now we don't have anything to import right now but we're going to import this tomo function first and then from polaris integrations we're going to import the register integrations function now it's actually not auto completing which is kind of annoying I'm going to see if i can configure

00:42:00.000 --> 00:42:59.999 align:start position:0%
see if I can configure the virtual environment right now so it knows what django version we're using and actually auto corrects and sorry one second here how are we doing on time we're a little pushed so we're a little pushed so okay this might go over a little bit for any of you who have just strictly an hour i apologize but we're gonna be in and I apologize but we're gonna be in and around an hour hopefully i don't need the autocomplete I don't need the autocomplete stuff but it will help for sure okay yeah no interpreter let's use the local one in our environment set it up okay now we have django available in our ide and actually knows what we're using so register integrations we're going to register our integration that we haven't even wrote yet

00:43:00.000 --> 00:43:59.999 align:start position:0%
and then why does it say that it doesn't have any why does it say that it doesn't have any of this that's concerning I don't know what's going on with the highlighting right now i thought i just configured my thought I just configured my virtual environment correctly but maybe i didn't I'm not going to spend maybe I didn't I'm not going to spend too much more time on this yeah actually this is not right this is our this is my system python let's add the environment that i have let's add the environment that I have in my there we go okay now we're using the virtual environment let's give this a second to adjust there we go okay yeah but we don't have this tomo file still but we're going to register our integration so polaris provides this register integrations function and you can look at the documentation on it here registering integration this is where you at this is where you add the custom you at this is where you add the custom code that you write to polaris so

00:44:00.000 --> 00:44:59.999 align:start position:0%
polaris can use it and so as you can see this is the exact and so as you can see this is the exact same code that we're writing right now we're registering our integrations and we're only going to register we're only going to register the ones that we have so we're not going to register all the ones that are listed here but let's get to it so this is the code that's going to run and this is the code that's going to run and it's only going to run as long as we have this default app config environment or variable here so I'm going to go apps dot or sorry app dot apps dot my app config that's going to tell django where to look for the code that needs to run before the application starts okay let's go to integrations we're going to just define this tonal function it's not going to have any arguments and we are just simply going to yeah that's all we need actually so let's let me show you what happens when we just have this so we've

00:45:00.000 --> 00:45:59.999 align:start position:0%
registered the function but the function has no code let's see what happens when we run the service so it broke and right now polaris is in debug mode so you're seeing this nice ui that shows you what's going on in the code typically it won't show you that i'll just give an error page if you're in production but what's going on here is that the integration that we provide the tonal function it's not providing what polaris expects and so you're going to want to look at and so you're going to want to look at the tonal function that we need to integrate so this is the that we need to integrate so this is the step one integration that we're doing right now we're integrating our tomal function and our total function needs to have a dictionary returned containing any of the keys the level keys right here so let's actually do that let's return a dictionary and let's do the documentation section first

00:46:00.000 --> 00:46:59.999 align:start position:0%
now you can look at step one to see what fields that you can list here so within documentation this is the organization documentation this is the information I'm gonna fill out right now these are the properties that you can add so let's add an org name let's add a we don't have a logo let's add a url we have a logo but I'm not going to get we have a logo but I'm not going to get it right now that's our home domain and that's all I'm going to provide for the organization but you get the point you can add any of these other keys as you can add any of these other keys as well let's add some point of contact information so polaris doesn't know who's actually building this and who's responsible for it so that's why we have this tomo file in so that's why we have this tomo file in this

00:47:00.000 --> 00:47:59.999 align:start position:0%
what they called point of contact or principles list so it's a list right so we're going to have a multitude of these we only have one though and that person's name is jake urban and that's all I'm going to provide I'm not going to provide my email or key base or anything like that but again you get the idea this is all but again you get the idea this is all information that's going to be injected into our tumble file let's re let's add some currency documentation so let's add a currency we're obviously anchoring srt actually let's just do let's get the

00:48:00.000 --> 00:48:59.999 align:start position:0%
and we only have one asset in our database so we're just going to get the first one and then let's use the code of that asset and the asset issuer okay and then we're also going to add the status so this again is a test token the status so this again is a test token right it's not actually real money so this is a test token srt is the so this is a test token srt is the dominated using two decimal places and we are going to give it a name

00:49:00.000 --> 00:49:59.999 align:start position:0%
okay let's see where we're at now so as you can see our code is refreshing every time or her service is refreshing every time we change our code and now we have some more information on our tomo file so congratulations we've done our first integration with polaris as you can see it has a principles section now it has the name that of the principle for this service it has all the information on the currency section that we entered and has some documentation about the organization who maintains this service cool so that is so this pattern of writing code registering that code with polaris and then having pillars use that code that that's the pattern of polaris it has a lot of stuff that can do on its has a lot of stuff that can do on its own but when it needs extra information that it can't automate it requests it from you via integration

00:50:00.000 --> 00:50:59.999 align:start position:0%
functions okay so we are doing decently on in terms of timing we have a couple more integrations to implement so now we have our tummle let's see how far we can get in the demo that i showed you earlier so in the demo that I showed you earlier so let's go to this demo spot let's look at our demo site let's look at the config we're not going to interface with our test anchor server on solar.org anymore we're going to actually work with our local machine we're going to use the same secret key for deposit and withdraw of our srt and we're automatically going to walk through the process I'm not gonna you know talk about exactly what's happening in the zep24 flow so what happens here okay well that's good so we have so let's take a step back for a second i will take a step back for a second I will actually go through a little bit what's going on here our client our wallet connected with our anchor it hit our tomo file because it knows to

00:51:00.000 --> 00:51:59.999 align:start position:0%
expect a tomo file at our home domain it determined that we have a transfer server it got the information on our transfer server so this is our this is our info endpoint and we actually haven't done any work here polaris does this completely on its own polaris responded with the client or responded from responded to the client all the information about the asset so as you can see we're anchoring srt for deposit it's enabled we have a minimum maximum amount as well as a fixed fee in percent this is going to be zero for the purpose of this demonstration but you can change these and then we actually went through authentication so for step 10 authentication you actually don't need to do anything either polaris influences straight out of the box and it also implements the deposit endpoint so once we got authenticated we made a request to make a deposit or the wallet did and we responded the anchor responded with a interactive url

00:52:00.000 --> 00:52:59.999 align:start position:0%
and the wallet opened up this interactive url for me the user to fill out and so that's what this is to fill out and so that's what this is a out of the box default don't do anything polaris view here of this interactive flow and so this is what the user would see and so this is what the user would see and I'm just going to say I'm depositing a hundred dollars there's no fee right so it's just a hundred dollars total and when i deposit okay that's a pilaris and when I deposit okay that's a pilaris thing if you wait too long on the first thing if you wait too long on the first screen it can authenticate your session so it's just 403. let's go through this whole thing again so we have a fresh token and get through the flow so 100 oh okay so this is actually a key piece oh okay so this is actually a key piece of development locally so it keeps on giving us 403 and that's because polaris by default expects to be working over https and if you aren't on https it doesn't allow you to go into on https it doesn't allow you to go into the interactive flow we can turn this off by adding a environment variable called local mode

00:53:00.000 --> 00:53:59.999 align:start position:0%
okay so now that we have this process and we're running in local mode let's see what happens okay let's try that one more time let's restart this service oh actually yeah I think that's still that makes sense the code the service restarts when the code is adjusted but not when the environment's adjusted so let's do that now that we've added our local mode environment variable sure okay so cool it successfully or it accepted our deposit request and it's now the anchor and it's now the anchor we're building is waiting for me the user to send the is waiting for me the user to send the funds to the anchor now on mainnet when you're doing this for real you're going to want to periodically ping your banking connection and see if i

00:54:00.000 --> 00:54:59.999 align:start position:0%
have sent the deposit that you have that i have the deposit that you have that I have initiated right and so again there's a process in the background that periodically pulls all the pending transactions all the transactions that we know the anchor knows we can expect payments into our bank account for and once they're there once we determine that a user has made a deposit into our bank a user has made a deposit into our bank account off chain we're going to then going to deposit the same amount of funds on chain and so that's how an anchor works with deposit but as you can see nothing's happening right now we're just continually pulling the anchor and it's still in this pending the user state pending the user state and that's because we aren't running a process on our server that checks for pending deposits so let's get out of this interactive flow here we're not quite done yet okay let's stop the server so this is a good point to talk about

00:55:00.000 --> 00:55:59.999 align:start position:0%
polaris so polaris is a web server right it implements the api endpoints defined in step 24 but there's also a variety of other tasks that polaris needs to perform in order to function properly one of those is checking up on pending deposits that we can expect from users right and so in order to actually check up on this polaris comes default with a pull pending deposits command line tool so what you would do is you would have the server running and you would also have this pull pending deposits process running as well and it's going to loop we could run this once and just check once for pending deposits or we could loop and run this i misspelled it loop and run this I misspelled it sounds like pull pending deposits okay so complain to me though because i haven't implemented the integration it says you know you're not ready to run this command line tool because you haven't implemented pull pending deposits yet

00:56:00.000 --> 00:56:59.999 align:start position:0%
and you're right so let's go to integrations so our first integration was just a function that we pass to polaris but this second integration is actually a part of a bigger class so we're going to implement a rails integration class so rails integration is a class an integration class that we're going to subclass and implement the functions outlined in rails integration integrations okay so we're going to define this pole pending deposits function and it comes with a bunch of type ending and it comes with a bunch of type ending that i don't have import that I don't have import imported currently

00:57:00.000 --> 00:57:59.999 align:start position:0%
okay and we actually are just going to return a list of all depending deposits so this is polaris so polaris is going to call this function periodically from the pole pending deposits process that we run and it's going to expect and it's going to expect that we connect to our bank look to see if there are any pending transactions that have actually been sent to us and then return the ones return the transaction objects that are passed return them back to polaris so players can actually submit them to the network right and so because we're not actually going to receive any payments on testnet we're actually going to just return every pending transaction and mark them essentially as ready and so this tells polaris to go ahead and move on and submit the transaction so let's go ahead and run this again let's run our server function and now let's run our

00:58:00.000 --> 00:58:59.999 align:start position:0%
python app manage.pi pull pending deposits process and loop it so it's always running okay it's still giving me problems because i actually haven't even because I actually haven't even registered this function right so now i have my tomo but i also have my so now I have my tomo but I also have my rails integration class so i want to register my rails so I want to register my rails integration class with the rails keyword of the register with the rails keyword of the register integrations function boom so now my pole putting deposits code is registered with polaris and running the pull pending deposits function was successful and i have my server running so let's go and I have my server running so let's go through a process again and see what happens so a process again and see what happens so this is the same as the last time I'm going to just say I'm going to deposit 100 and polaris is just going to move on it's going to assume that i sent it it's going to assume that I sent it so Stellar is actually executing the transaction now and it's actually on the seller network

00:59:00.000 --> 00:59:59.999 align:start position:0%
it's giving me srt in the tote in the wallet that i used in the tote in the wallet that I used boom there you go complete so if i were boom there you go complete so if I were to look at the account that I'm using for this wallet right now i would see that i have at least 100 srt I would see that I have at least 100 srt in my account the polaris server using the asset that I'm issuing deposited funds into my seller account after me entering information so there you go that's the deposit endpoint it's fully implemented ready to go it is 11 o'clock an hour on the dot and you have a deposit hour on the dot and you have a deposit flow working now there are other integration functions that i need to implement for functions that I need to implement for withdraw i think at this point i have to decide I think at this point I have to decide do i want to in terms of timing do i do I want to in terms of timing do i want to go further down and build out the deposit flow or do i want to build with draw flow do I want to build with draw flow and just not go into detail in the deposit flow because there's a lot more you could do i think I'm going to do the latter so I think I'm going to do the latter so I'm not going to do this in the talk but

01:00:00.000 --> 01:00:59.999 align:start position:0%
there's tons of customization that you can do using the integrations that pilars provides for the deposit flow so again you can customize the ui you can make it a different color you can change the forms presented and then you can add forms so right now and then you can add forms so right now in this demonstration we're just asking for the amount but we actually don't even collect anything about our users and again this is custom to each anchor right so polaris doesn't do this automatically instead it expects you as the developer to provide django forms that's going to be presented to the user and then you can process so I'm not going to go through this we just don't have the time but this integration this these section of integration functions are called form integrations and they're actually available on the in the documentation if you go to step 24 integrations set 24 integrations and this form integrations section outlines what I'm not going to do in this talk what I'm not going to do in this talk today which is provide content for every transaction so this is

01:01:00.000 --> 01:01:59.999 align:start position:0%
providing forms and ui customization for every form that you need to collect on the user so if you need name and on the user so if you need name and email and photo id and anything like that you can ask that from the user using polaris using these integration functions as long as you register them but we're not going to do that instead we're going to prioritize having a withdrawal flow having a withdrawal flow work and to do that we're going to run work and to do that we're going to run the entire service so not just pull pending deposits we're going to run every process that requires and to do that we're going to use docker and to do that we're going to use docker and docker compose so I'm just going to copy and paste the so I'm just going to copy and paste the docker compose and docker file from this project that i've already written so copy docker file copy docker compose and I'm going to go into the anchor that and I'm going to go into the anchor that we're building right now so we have these two files now and if so we have these two files now and if you look at them again all the source code for this is going to be on my github

01:02:00.000 --> 01:02:59.999 align:start position:0%
but this is essentially a config file that's going to run all the processes that you need to run in order to run a deposit and withdraw step 24 anchor so as you can see we run the server the thing that actually runs the step 24 protocol we run the pull putting deposits or sorry pull pending deposits process that i showed earlier there's process that I showed earlier there's also three others for withdraw and I'm just going to speed through this because we're going to do some questions afterwards and i don't want to go too afterwards and I don't want to go too far over so we're going to build actually no before we build our application we're going to implement our reg our integration functions for withdraw so withdraw has some integration functions that it requires on top of what it you know what you have for deposit specifically it has this outgoing execute outgoing integration function that you execute the transaction this transaction or this function this transaction or this function polaris calls expecting you to actually

01:03:00.000 --> 01:03:59.999 align:start position:0%
make a payment so this assumes you've received a withdrawal payment from the user on the Stellar network and you're actually going to send the same amount of funds off chain to the user via your banking rails so we're actually not going to do any banking rails in this right we're not going to connecting to any bank we're just going to mark the transaction as completed and say that we did actually submit it to the bank even though we didn't this is just for demonstration purposes on in when you're actually doing this and writing your integration functions you will want to connect your bank just like in full penny deposits completed and we're also going to update the fee for the transaction so right before we execute we're going to mark or we're going to calculate the fee that we're going to take from the transaction so the user send me 100 we don't have any fees in this demo but we don't have any fees in this demo but you can charge fees and but for now I'm just going to say zero right

01:04:00.000 --> 01:04:59.999 align:start position:0%
so this function is going to be called every time we need to actually send a payment to a user and then finally actually that's all we need for withdraw i think and we're going to make this multi-process application by this multi-process application by building oh man i need to start my oh man I need to start my docker daemon that's loading up so docker's getting started okay it's five minutes over I'm going to try to build the rest of the service in the meantime I'm open to questions if we want to i will just probably be working I will just probably be working through this and demonstrating that withdrawal flow as i answer that withdrawal flow as I answer questions so to the host of this event if you would like to give me some questions go ahead and i'll answer them as we're working on this

01:05:00.000 --> 01:05:59.999 align:start position:0%
okay so the you know one question is why use django that's a good question django has the tools necessary to do what we're trying to do so flask doesn't have this reusable app structure right so django is a project that can contain any number of apps that you can plug and any number of apps that you can plug and play flask doesn't have this requirement or flask doesn't have this functionality right you have a this functionality right you have a flask application and what the code is in flask is what it is right you can't just add is what it is right you can't just add an app you can install a package and use an app you can install a package and use that package but you can't just plug and play an app so that ability to plug and play an app so that ability to just plug and play polaris that comes with database models and endpoints that's unique to django and so it just made sense for us to do it this way just made sense for us to do it this way as long as we are using the python stack

01:06:00.000 --> 01:06:59.999 align:start position:0%
so we have our docker process up and we're building our containers our containers so again this is oh what's the problem here service server fail to build copy failed requirements.txt oh yeah we don't have a requirements file let's create one pip freeze requirements dot text and this is just putting all our dependencies in a text file so when we launch our docker image it can build them according to the file okay so we're installing our dependencies right now and this is probably just going to take a minute and once that completes we are going to compile our static assets i think is the next step let's look at I think is the next step let's look at this docker file yeah so we're going to install system

01:07:00.000 --> 01:07:59.999 align:start position:0%
packages we're going to make a working home directory we're going to make a data directory for our database we're going to copy our app code copy our environment requirements files we're going to install those requirements and then we're going to compile our static assets then once we've done all that we're going to run the run server command and actually run our application okay so now if i run docker compose up so now if I run docker compose up hopefully this works yay okay so now we have all these processes pull depending deposits watch transactions the actual step24 server and we all have it running so and we all have it running so let's go ahead to our demo and look at what the withdrawal flow looks like now again I'm going to deposit 100 there's no fee and for a draw the wallet actually submits the transaction to Stellar and the anchor is going to receive that the anchor's going to receive that payment so I'm confirming that i that payment so I'm confirming that i want to send this payment to the anchor

01:08:00.000 --> 01:08:59.999 align:start position:0%
the wallet is making a Stellar payment to that anchor right now the our anchor service that we built is going to pick up that payment via our watch transactions process and watch transactions is going to then mark it as ready for execution the polaris will then call our execute outgoing transaction function that we wrote and it will mark the transaction as completed and as you can see our transaction has completed and so we have effectively withdrawn funds from our Stellar anchor account or from our Stellar account and we now presumably have them off chain in our bank account and so obviously we're not collecting the bank details so like typically an anchor would say what's your bank account number what's your bank routing number we need to know so that we can actually send you this money and so we're not collecting that and again the documentation is there and polaris provides that functionality but we're not going to request that information right now in this demo

01:09:00.000 --> 01:09:59.999 align:start position:0%
okay cool awesome so we're 10 minutes over not too bad but yeah that's how you build an anchor using polaris there are a lot of other integrations polaris is pretty extensive and it's in the beta phase or not beta phase but it's in pre 1.0 release so there are still pre 1.0 release so there are still breaking changes that are being made occasionally but therefore ultimately to become stable and to make a 1.0 release that will be and to make a 1.0 release that will be coming soon okay cool i think we're done in terms of okay cool I think we're done in terms of demonstration now I'm going to open it up for questions so that is a good question so there was a question about node.js and whether or not we're willing to make a version for node.js and the ques the answer that question is keep asking we've gotten a handful of requests for it

01:10:00.000 --> 01:10:59.999 align:start position:0%
but the reality is that at the moment it's gonna be a lot of work for our team to maintain two different versions of it so it's not worth it for us so it's not worth it for us yet but if there is significant demand then we might deem it worthwhile so make it known if you want to use node and we can discuss that further and we can discuss that further on github or via key base or however you want to contact us I'm trying to think if there's anything else that i should mention else that I should mention so this we did step 24 in this case right this is polaris implements step 24 but again it also implements a lot of other steps one that we just added support for is set 31. step 31 is a set or a standard that step 31 is a set or a standard that allows two anchors to facilitate international remittance payments so the idea is that

01:11:00.000 --> 01:11:59.999 align:start position:0%
user a would send money to user b by giving money to their to one acre that anchor would send money to a different anchor and then the receding user would or sorry the receiving anchor is going to send that money that it received from the anchor from the sending anchor to the receiving user so it's this little like anchor or sorry user anchor user flow and the cool thing about this is that users don't even need to know that they're using stuller it's just a payment from one bank account transaction to the next and so plars provides the integrations necessary to support a sep31 receiving anchor so if somebody wants to send you payments from across the world in a different currency and you want to use those funds that sent to you to then use those funds that sent to you to then pay your own customers in their home currency you can do that using polaris step31 integration

01:12:00.000 --> 01:12:59.999 align:start position:0%
okay so I think that's it for questions thank you guys for tuning in and hopefully you guys learned a lot about polaris and how it works if you have any further questions I'm available on key base that's where a lot of our on key base that's where a lot of our sdf employees live in terms of chat and yeah all right thank you for tuning in have a good day guys
